import{serializable as a,RectTransform as di,Behaviour as h,Mathf as b,GameObject as m,OrbitControls as Qt,Text as U,NeedleXRSession as R,getTempVector as v,Camera as Oe,serializeable as g,WebXR as mi,setWorldPosition as gt,Rigidbody as E,AudioSource as H,InstantiateOptions as ye,Renderer as C,InstancingUtil as ui,Button as xt,ActionBuilder as _,USDObject as ft,BehaviorModel as L,TriggerBuilder as F,Volume as fi,getWorldPosition as X,getParam as j,Gizmos as I,ParticleSystem as Yt,setParamWithoutReload as Zt,EventList as x,setWorldQuaternion as Nt,getWorldQuaternion as Ut,Animator as kt,WebXRImageTracking as gi,DeviceUtilities as w,LODGroup as bi,syncField as G,showBalloonMessage as f,AssetReference as Pe,screenshot2 as xi,DragControls as vi,Animation as vt,USDZExporter as wt,isDevEnvironment as J,delay as zt,SceneSwitcher as wi,RoomEvents as _i,Collider as _t,LogType as Ce,WaitForSeconds as Oi,isMobileDevice as yi,NeedleMenu as Pi,getTempQuaternion as Ci,AnimationCurve as ji,NeedleXRController as ge,XRControllerFollow as Si,delayForFrames as Bt,MeshRenderer as Di,ParticleSystemShapeType as Ft,isDestroyed as je,instantiate as Ti,AnimationExtension as Ei,PlayAnimationOnClick as be,getOrAddComponent as Mi,FileReference as Ot,findObjectOfType as Se,ImageReference as Ai,PlayableDirector as $i,TypeStore as c,Canvas as Ii,CanvasGroup as De,getWorldScale as xe,WebXRButtonFactory as Li}from"./needle-engine@4.8.4.js";import{o as Te,P as Fi,aB as S,y as bt,h as Ee,a6 as Me,aS as Wt,V as P,i as Vi,M as Ni,T as Ui,u as zi,t as Wi,f as Ri,bg as Hi,bA as Gi,bJ as qi,cS as Ki,cT as Qi,aq as ve,a1 as Yi,cJ as Zi,cu as ki,cz as Bi,cU as Xi}from"./three@0.169.7.js";import{C as Ji,a as ts,b as es}from"./three-examples.3648dafa.js";import"./gltf-progressive.dfeff810.js";import"./three-mesh-ui.8476b268.js";import"./three-quarks.ef198aad.js";import"./postprocessing.b82d4b06.js";var is=Object.defineProperty,ss=Object.getOwnPropertyDescriptor,Ae=(r,t,i,s)=>{for(var e=s>1?void 0:s?ss(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&is(t,i,e),e};class Xt extends h{constructor(){super(...arguments),this.safeArea=new Te(0,0)}update(){var e,n,o;const t=this.context.domWidth/this.safeArea.x,i=this.context.domHeight/this.safeArea.y,s=b.clamp(Math.min(t,i),0,1);(e=this.rectTransform)==null||e.scale.setScalar(s),(o=(n=this.rectTransform)==null?void 0:n.shadowComponent)==null||o.scale.setScalar(s)}}Ae([a(di)],Xt.prototype,"rectTransform",2);Ae([a(Te)],Xt.prototype,"safeArea",2);var rs=Object.defineProperty,ns=Object.getOwnPropertyDescriptor,Jt=(r,t,i,s)=>{for(var e=s>1?void 0:s?ns(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&rs(t,i,e),e};class yt extends h{constructor(){super(...arguments),this.createMenuButton=!1,this.teleportVRPlayer=!1,this.ignoreYInVR=!1,this.menuButton=null}get orbitalCamera(){return this._orbitalCamera??(this._orbitalCamera=m.findObjectOfType(Qt)),this._orbitalCamera}awake(){this.createMenuButton&&this.addButton()}addButton(){var s;this.menuButton&&this.removeButton();const t=((s=this.gameObject.getComponentInChildren(U))==null?void 0:s.text)??this.gameObject.name,i=document.createElement("button");this.menuButton=i,i.innerText=t.replace("_"," "),i.setAttribute("priority","40"),i.addEventListener("click",()=>this.use()),this.context.menu.appendChild(i)}removeButton(){this.menuButton&&(this.menuButton.remove(),this.menuButton=null)}use(){var i,s;(i=this.orbitalCamera)==null||i.setCameraTargetPosition(this.worldPosition);const t=(s=R.active)==null?void 0:s.rig;if(this.teleportVRPlayer&&this.context.isInVR&&t){const e=v(this.worldPosition);this.ignoreYInVR&&(e.y=t.gameObject.worldPosition.y),t.gameObject.worldPosition=e}}}Jt([a()],yt.prototype,"createMenuButton",2);Jt([a()],yt.prototype,"teleportVRPlayer",2);Jt([a()],yt.prototype,"ignoreYInVR",2);class os extends h{constructor(){super(...arguments),this.cam=null}onEnable(){this.cam=this.gameObject.getComponent(Oe),this.cam||(console.warn("CameraLayer requires a Camera component"),this.enabled=!1)}onAfterRender(){if(!this.cam)return;const t=this.scene.background;this.context.renderer.autoClearColor=!1,this.cam.cam instanceof Fi&&this.context.updateAspect(this.cam.cam),this.scene.background=null,this.context.renderer.render(this.scene,this.cam.cam),this.scene.background=t}}var as=Object.defineProperty,ls=Object.getOwnPropertyDescriptor,Pt=(r,t,i,s)=>{for(var e=s>1?void 0:s?ls(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&as(t,i,e),e};class tt extends h{constructor(){super(...arguments),this.strength=10,this.maxInstances=10,this._instances=[],this._index=-1,this._onPointerDown=t=>{t.button===0&&this.throwBall(t.space.worldPosition,t.space.worldForward)}}start(){this.prefab&&m.setActive(this.prefab,!1),this.webXR??(this.webXR=m.findObjectOfType(mi))}onEnable(){this.context.input.addEventListener("pointerdown",this._onPointerDown)}onDisable(){this.context.input.removeEventListener("pointerdown",this._onPointerDown)}throwBall(t,i){var o,l;if(!this.prefab)return;if(this._instances.length<this.maxInstances){const p=new ye;p.position=t;const d=m.instantiate(this.prefab,p);if(!d)return;this._instances.push(d)}const s=++this._index,e=this._instances[s%this._instances.length];if(!e)return;gt(e,t),m.setActive(e,!0),(o=this.audioSource)==null||o.stop(),(l=this.audioSource)==null||l.play();const n=m.getComponent(e,E);n&&(i.multiplyScalar(this.strength),n.resetForcesAndTorques(),n.resetVelocities(),n==null||n.applyImpulse(i))}}Pt([g(S)],tt.prototype,"prefab",2);Pt([g(H)],tt.prototype,"audioSource",2);Pt([g()],tt.prototype,"strength",2);Pt([g()],tt.prototype,"maxInstances",2);var hs=Object.defineProperty,cs=Object.getOwnPropertyDescriptor,$e=(r,t,i,s)=>{for(var e=s>1?void 0:s?cs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&hs(t,i,e),e};class te extends h{constructor(){super(...arguments),this.applyOnStart=!0,this.randomMetallicRoughness=!0}start(){{const t=this.gameObject.getComponent(C);if(!t)return;for(let i=0;i<t.sharedMaterials.length;i++)t.sharedMaterials[i]=t.sharedMaterials[i].clone()}this.applyOnStart&&this.applyRandomColor()}applyRandomColor(){const t=this.gameObject.getComponent(C);if(!t){console.warn("Can not change color: No renderer on "+this.name);return}for(let i=0;i<t.sharedMaterials.length;i++){const s=t.sharedMaterials[i];s.color=new bt(Math.random(),Math.random(),Math.random()),this.randomMetallicRoughness&&s instanceof Ee&&(s.metalness=Math.random(),s.roughness=Math.random()*Math.random()),s.needsUpdate=!0,ui.markDirty(this.gameObject)}}}$e([g()],te.prototype,"applyOnStart",2);$e([g()],te.prototype,"randomMetallicRoughness",2);class ps extends h{constructor(){super(...arguments),this.renderer=null,this.collisionCount=0}start(){if(this.renderer=this.gameObject.getComponent(C),!!this.renderer){this._startColor||(this._startColor=[]);for(let t=0;t<this.renderer.sharedMaterials.length;t++)this.renderer.sharedMaterials[t]=this.renderer.sharedMaterials[t].clone(),this._startColor[t]=this.renderer.sharedMaterials[t].color.clone()}}onCollisionEnter(t){if(this.renderer){this.collisionCount+=1;for(let i=0;i<this.renderer.sharedMaterials.length;i++)this.renderer.sharedMaterials[i].color.setRGB(Math.random(),Math.random(),Math.random())}}onCollisionExit(t){if(!(!this.renderer||!this._startColor)&&(this.collisionCount-=1,this.collisionCount===0))for(let i=0;i<this.renderer.sharedMaterials.length;i++)this.renderer.sharedMaterials[i].color.copy(this._startColor[i])}}var ds=Object.defineProperty,ms=Object.getOwnPropertyDescriptor,us=(r,t,i,s)=>{for(var e=s>1?void 0:s?ms(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&ds(t,i,e),e};class Ie extends h{update(){this.myMaterial&&(this.myMaterial._Speed*=1+this.context.time.deltaTime,this.myMaterial._Speed>1&&(this.myMaterial._Speed=5e-4),this.context.time.frame%30===0&&console.log(this.myMaterial._Speed))}}us([a(Me)],Ie.prototype,"myMaterial",2);var fs=Object.defineProperty,gs=Object.getOwnPropertyDescriptor,bs=(r,t,i,s)=>{for(var e=s>1?void 0:s?gs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&fs(t,i,e),e};class Le extends h{click(){var t,i;(i=(t=this.buttonToClick)==null?void 0:t.onClick)==null||i.invoke()}}bs([a(xt)],Le.prototype,"buttonToClick",2);var xs=Object.defineProperty,vs=Object.getOwnPropertyDescriptor,ws=(r,t,i,s)=>{for(var e=s>1?void 0:s?vs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&xs(t,i,e),e};class Fe extends h{constructor(){super(...arguments),this.objectToMatrix=new Map}start(){var t;(t=this.target)==null||t.traverse(i=>{this.objectToMatrix.set(i,i.matrix.clone())})}onPointerClick(t){for(const[i,s]of this.objectToMatrix)i.matrix.copy(s),i.matrix.decompose(i.position,i.quaternion,i.scale),i.matrixWorldNeedsUpdate=!0}createBehaviours(t,i,s){if(i.uuid!==this.gameObject.uuid||!this.target)return;const e=_.parallel();for(const[p,d]of this.objectToMatrix){const u=ft.createEmpty();u.matrix=d,p.parent&&u.matrix.premultiply(p.parent.matrixWorld),s.document.add(u),e.addAction(_.transformAction(p,u,0,"absolute","none"))}const n=new L("click_to_reset",F.tapTrigger(this.gameObject),e);t.addBehavior(n);const o=ft.createEmpty();o.name="InputTarget",o.displayName=void 0,o.type="RealityKitComponent",o.onSerialize=p=>{p.appendLine("bool allowsDirectInput = 1"),p.appendLine("bool allowsIndirectInput = 1"),p.appendLine('uniform token info:id = "RealityKit.InputTarget"')},i.add(o);const l=ft.createEmpty();l.name="HoverEffect",l.displayName=void 0,l.type="RealityKitComponent",l.onSerialize=p=>{p.appendLine('uniform token info:id = "RealityKit.HoverEffect"')},i.add(l)}}ws([a(m)],Fe.prototype,"target",2);var _s=Object.defineProperty,Os=Object.getOwnPropertyDescriptor,ee=(r,t,i,s)=>{for(var e=s>1?void 0:s?Os(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&_s(t,i,e),e};class Ct extends h{constructor(){super(...arguments),this.apertureMultiplier=2,this.focalLength=.001,this.focusDistanceCutoff=25,this.volume=null,this.dofEffect=void 0}onEnable(){var t,i,s;this.volume=m.findObjectOfType(fi),this.dofEffect=(s=(i=(t=this.volume)==null?void 0:t.sharedProfile)==null?void 0:i.components)==null?void 0:s.find(e=>e.typeName==="DepthOfField"),this.orbit=m.findObjectOfType(Qt)}onBeforeRender(){var i;if(!((i=this.orbit)!=null&&i.controls))return;const t=this.orbit.controls.target.distanceTo(X(this.orbit.gameObject));if(this.dofEffect){this.dofEffect.focusDistance.value=t,this.dofEffect.focalLength.value=this.focalLength;let s=b.inverseLerp(0,this.focusDistanceCutoff,t);s=b.clamp01(s),this.dofEffect.aperture.value=b.lerp(this.apertureMultiplier,32,s);const e=this.focusDistanceCutoff;t>e&&this.dofEffect.active?this.dofEffect.active=!1:t<e&&!this.dofEffect.active&&(this.dofEffect.active=!0)}}}ee([a()],Ct.prototype,"apertureMultiplier",2);ee([a()],Ct.prototype,"focalLength",2);ee([a()],Ct.prototype,"focusDistanceCutoff",2);class ys extends h{constructor(){super(...arguments),this._previousEnvironmentTexture=null}onEnable(){this._previousEnvironmentTexture=this.context.scene.environment,this.context.scene.environment=null}onDisable(){this.context.scene.environment=this._previousEnvironmentTexture}}var Ps=Object.defineProperty,Cs=Object.getOwnPropertyDescriptor,js=(r,t,i,s)=>{for(var e=s>1?void 0:s?Cs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ps(t,i,e),e};const Ss=j("sample_debugParticlesOnClick");class Ve extends h{constructor(){super(...arguments),this.particleSystems=[]}update(){if(!this.context.isInVR&&this.context.input.getPointerClicked(0)){const t=this.context.physics.raycast();t.length>0&&this.spawnParticlesAt(t[0].point)}}onUpdateXR(t){t.xr.controllers.forEach(i=>{var s,e;if(((s=i.getButton("primary"))==null?void 0:s.isDown)===!0){const n=(e=this.context.physics.raycastFromRay(i.ray))==null?void 0:e.at(0);n&&this.spawnParticlesAt(n.point)}})}spawnParticlesAt(t){gt(this.gameObject,t),Ss&&I.DrawWireSphere(t,.5,16711680,1);for(const i of this.particleSystems)i&&(m.setActive(i.gameObject,!0),i.play())}}js([g(Yt)],Ve.prototype,"particleSystems",2);var Ds=Object.defineProperty,Ts=Object.getOwnPropertyDescriptor,Es=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ts(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ds(t,i,e),e};class Ne extends h{constructor(){super(...arguments),this.parameters=[]}awake(){var t=!1;this.parameters.forEach(i=>{j(i)||(Zt(i,""),t=!0)}),t&&window.location.reload()}}Es([a()],Ne.prototype,"parameters",2);var Ms=Object.defineProperty,As=Object.getOwnPropertyDescriptor,Ue=(r,t,i,s)=>{for(var e=s>1?void 0:s?As(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ms(t,i,e),e};class ie extends h{constructor(){super(...arguments),this.htmlSelector="button.some-button",this.onClick=new x,this.onClicked=()=>{this.onClick.invoke()}}onEnable(){this.element=document.querySelector(this.htmlSelector),this.element?this.element.addEventListener("click",this.onClicked):console.warn(`Could not find element with selector "${this.htmlSelector}"`)}onDisable(){this.element&&this.element.removeEventListener("click",this.onClicked)}}Ue([g()],ie.prototype,"htmlSelector",2);Ue([a(x)],ie.prototype,"onClick",2);var $s=Object.defineProperty,Is=Object.getOwnPropertyDescriptor,ze=(r,t,i,s)=>{for(var e=s>1?void 0:s?Is(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&$s(t,i,e),e};class se extends h{constructor(){super(...arguments),this.createdElements=[]}onEnable(){var t;if(!(!this.methods||!this.names))for(let i=0;i<this.methods.length;i++){const s=this.methods[i];let e="Button";i<((t=this.names)==null?void 0:t.length)&&(e=this.names[i]);const n=document.createElement("button");n.innerHTML=e,n.onclick=()=>{s.invoke()},this.context.menu.appendChild(n),this.createdElements.push(n)}}onDisable(){for(const t of this.createdElements)t.remove()}reloadPageInSeconds(t){setTimeout(()=>{location.reload()},t*1e3)}}ze([a(x)],se.prototype,"methods",2);ze([a()],se.prototype,"names",2);var Ls=Object.defineProperty,Fs=Object.getOwnPropertyDescriptor,jt=(r,t,i,s)=>{for(var e=s>1?void 0:s?Fs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ls(t,i,e),e};class et extends h{constructor(){super(...arguments),this.url="https://www.youtube.com/embed/puWNRrG4MCg",this.pixelsPerUnit=500,this.borderRadius=50,this.animator=null,this.rotate90=new Wt().setFromAxisAngle(new P(0,1,0),Math.PI)}start(){const t=j("url");t&&(this.url=t);const i=document.createElement("div");i.innerHTML='<iframe width="1000" height="1000" title="" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; xr-spatial-tracking; xr" allowfullscreen></iframe>',i.style.zIndex="10000",i.style.position="absolute",i.style.pointerEvents="initial";const s=i.querySelector("iframe");s.addEventListener("load",()=>{setTimeout(()=>{var p;console.log("Automatically opening iframe"),(p=this.animator)==null||p.SetBool("Open",!0)},1e3)}),s.src=this.url;let e=1e3;const n=Math.round(this.gameObject.scale.x*this.pixelsPerUnit),o=Math.round(this.gameObject.scale.y*this.pixelsPerUnit);e=Math.max(n,o),s.width=n+"px",s.height=o+"px",i.style.position="absolute",this.borderRadius>0&&(i.style.borderRadius=this.borderRadius+"px"),i.style.pointerEvents="initial",document.body.append(i),this.cssRenderer=new Ji,this.cssRenderer.domElement.style.pointerEvents="none",this.cssRenderer.domElement.style.position="absolute",this.cssRenderer.domElement.style.top="0px",document.body.append(this.cssRenderer.domElement),this.cssScene=new Vi;const l=new ts(i);l.scale.setScalar(Math.max(this.gameObject.scale.x,this.gameObject.scale.y)/e),gt(l,X(this.gameObject)),Nt(l,Ut(this.gameObject)),l.quaternion.multiply(this.rotate90),this.cssScene.add(l),this.cssObj=l,this.context.post_render_callbacks.push(this.onPostRender.bind(this))}onPostRender(){if(!this.cssObj||!this.cssRenderer||!this.cssScene)return;gt(this.cssObj,X(this.gameObject)),Nt(this.cssObj,Ut(this.gameObject)),this.cssObj.quaternion.multiply(this.rotate90);const t=this.context.mainCamera,i=this.gameObject;var s=t.position.clone().sub(this.gameObject.position).normalize(),e=i.getWorldDirection(new P);const n=s.dot(e);this.cssObj.visible=n<.15;const o=this.cssRenderer.getSize();(o.width!==this.context.domWidth||o.height!==this.context.domHeight)&&this.cssRenderer.setSize(this.context.domWidth,this.context.domHeight),this.cssRenderer.render(this.cssScene,this.context.mainCamera)}}jt([g()],et.prototype,"url",2);jt([g()],et.prototype,"pixelsPerUnit",2);jt([g()],et.prototype,"borderRadius",2);jt([g(kt)],et.prototype,"animator",2);class Vs extends h{constructor(){super(...arguments),this._ui=null,this._incubationsHint=null,this._components=[]}onEnable(){var e;(e=this._ui)==null||e.remove(),this._components=m.findObjectsOfType(gi);const t=document.createElement("div");t.style.cssText=`
            font-family: 'Roboto flex', Ariel;
            position: absolute;
            top: 1em;
            left: 1em;
            line-height: 1.5em;
            display: block;
            width: 200px;
        `,this.context.domElement.appendChild(t),this._ui=t;const i=document.createElement("h2");i.style.cssText=`
            margin-bottom: .7em;
        `,i.innerText="Sample Images",t.appendChild(i);const s=document.createElement("p");s.innerHTML=`Download the image and print it or you can also open the image in your browser
        <br><strong>Then enter AR and scan it with your camera.</strong>
        <br>Visit our <a target="_blank" href="https://docs.needle.tools/image-tracking">ImageTracking documentation</a> for more information.
        `,s.style.userSelect="all",t.appendChild(s);for(const n of this._components)this.createDownloadImageUI(n,t)}onDisable(){var t;(t=this._ui)==null||t.remove()}update(){var t;this.context.isInAR?(t=this._ui)==null||t.remove():this._ui&&!this._ui.parentNode&&this.context.domElement.appendChild(this._ui)}onUpdateXR(t){if(t.xr.frame&&!("getImageTrackingResults"in t.xr.frame)&&!this._incubationsHint&&this._ui&&w.isAndroidDevice()){const i=document.createElement("p");i.style.cssText=`
                    background: rgba(255, 100, 100, .7);
                    border-radius: .5rem;
                    padding: .4rem;
                `,i.innerText="WebXR ImageTracking is not enabled. Go to chrome://flags/#webxr-incubations and enable #webxr-incubations",this._ui.append(i),this._incubationsHint=i}}createDownloadImageUI(t,i){if(t.trackedImages)for(const s of t.trackedImages){if(!s.image)continue;const e=document.createElement("a");e.href=s.image,e.target="_blank",i.appendChild(e);const n=document.createElement("img");n.src=s.image,n.style.cssText=`
                min-width: 180px;
                max-width: 220px;
                width: 15vw;
                height: auto;
                aspect-ratio: 1.3;
                object-fit: cover;
                background: rgba(0,0,0,0.5);
                border-radius: 10px;
                border: 2px solid rgba(255,255,255,1);
                box-shadow: 0 0 10px rgba(0,0,0,.2);
                margin-left: -.5em;
            `,e.appendChild(n)}}}var Ns=Object.defineProperty,Us=Object.getOwnPropertyDescriptor,We=(r,t,i,s)=>{for(var e=s>1?void 0:s?Us(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ns(t,i,e),e};class re extends h{constructor(){super(...arguments),this.tempVec1=new P,this.tempVec2=new P}update(){if(!this.lodGroup||!this.text)return;const t=this.context.mainCamera;t.getWorldPosition(this.tempVec1),this.gameObject.getWorldPosition(this.tempVec2);const i=this.tempVec1.distanceTo(this.tempVec2)/t.zoom,s=this.lodGroup._lodsHandler;let e=null;s==null||s.forEach(n=>{var d,u;const o=n.levels[n.getCurrentLevel()],l=n.levels.at(n.getCurrentLevel()+1);let p=null;if(o.object instanceof Ni){const y=o.object.geometry.attributes,$=Math.floor(((d=y.position)==null?void 0:d.count)||0);p=`Triangles: ${Math.floor((((u=y.index)==null?void 0:u.count)||$)/3)}, Vertices: ${$}`}o.object.name.replace(/_/g,""),o.object.name.includes("Cull")||(e="",p&&(e+=`${p}
`),l==null||l.hysteresis,e+=`${o.distance.toFixed(1)} / ${i.toFixed(1)}`,l&&(e+=` / ${(l.distance-l.distance*l.hysteresis).toFixed(1)}`))}),e||(e="culled"),this.text.text=e}}We([a(bi)],re.prototype,"lodGroup",2);We([a(U)],re.prototype,"text",2);var zs=Object.defineProperty,Ws=Object.getOwnPropertyDescriptor,ne=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ws(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&zs(t,i,e),e};class Rt extends h{onColorChanged(){typeof this.color=="number"&&(this.color=new bt(this.color)),this.setColorToMaterials()}onPointerClick(t){const i=new bt(Math.random(),Math.random(),Math.random());this.color=i}onEnable(){f("<strong>Click an object</strong> to change the color. Open this window in another browser tab/window to see the networking in action..."),this.setColorToMaterials()}setColorToMaterials(){var i;const t=this.gameObject.getComponent(C);if(t)for(let s=0;s<t.sharedMaterials.length;s++){const e=(i=t.sharedMaterials[s])==null?void 0:i.clone();t.sharedMaterials[s]=e,e&&"color"in e&&(e.color=this.color)}else console.warn("No renderer found",this.gameObject)}}ne([G(Rt.prototype.onColorChanged),a(bt)],Rt.prototype,"color",2);class Ht extends h{constructor(){super(...arguments),this.myArray=[],this.updateArray=()=>{const t=new Date().toLocaleTimeString();console.log("> Update array",t),this.myArray.length>10&&(console.log("Clearing array because we have reached 10 entries"),this.myArray.length=0),this.myArray.push(t),this.myArray=this.myArray,f(`<strong>> Send</strong> "${t}", ${this.myArray.length} elements`)}}onArrayChanged(){console.log("< Received array",this.myArray[this.myArray.length-1],this.myArray),f(`<strong>< Received</strong> "${this.myArray[this.myArray.length-1]}", we now have ${this.myArray.length} elements`)}start(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateArray,4e3)}}ne([G(Ht.prototype.onArrayChanged)],Ht.prototype,"myArray",2);class Rs{constructor(){this.name="",this.age=0}}class Gt extends h{constructor(){super(...arguments),this.myObject=new Rs,this.updateObject=()=>{this.myObject.name=this.context.connection.connectionId,this.myObject.age+=1,this.myObject=this.myObject,console.log("> Updated",this.myObject),f('<strong>> Sent</strong> "'+this.myObject.name+'" is '+this.myObject.age+" years old")}}onObjectChanged(){console.log("< Received object",this.myObject),f(`<strong>< Received</strong> "${this.myObject.name}" is ${this.myObject.age} years old`)}awake(){f("Open this window in another browser tab/window to see the networking in action..."),setInterval(this.updateObject,5e3)}}ne([G(Gt.prototype.onObjectChanged)],Gt.prototype,"myObject",2);var Hs=Object.defineProperty,Gs=Object.getOwnPropertyDescriptor,Re=(r,t,i,s)=>{for(var e=s>1?void 0:s?Gs(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Hs(t,i,e),e};class oe extends h{constructor(){super(...arguments),this.clampFrameRate=!0,this._clampFrameRate=!1,this.maxFrameRate=72,this._maxFrameRate=-1024}update(){if(this._clampFrameRate!==this.clampFrameRate||this._maxFrameRate!==this.maxFrameRate){const t=this.clampFrameRate?this.maxFrameRate:void 0;this.context.targetFrameRate=t,this._clampFrameRate=this.clampFrameRate,this._maxFrameRate=this.maxFrameRate}}setTarget(t){this.maxFrameRate=t,this.clampFrameRate=!0}setClamping(t){this.clampFrameRate=t}}Re([a()],oe.prototype,"clampFrameRate",2);Re([a()],oe.prototype,"maxFrameRate",2);var qs=Object.defineProperty,Ks=Object.getOwnPropertyDescriptor,St=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ks(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&qs(t,i,e),e};class it extends h{constructor(){super(...arguments),this.width=1024,this.height=1024,this.prefab=null}takePhoto(){const t=xi({type:"texture",camera:this.camera,width:this.width,height:this.height});this.prefab&&t instanceof Ui&&this.prefab.instantiate(this.scene).then(i=>{if(!i)return;setTimeout(()=>{i.destroy()},2e3),i==null||i.position.set(0,3,0),i==null||i.getOrAddComponent(vi);const s=i==null?void 0:i.getComponentInChildren(E);s&&(s.teleport(this.gameObject.worldPosition.add({x:0,y:.5,z:0})),s.setAngularVelocity(Math.random()-.5,Math.random()-.5,Math.random()*2-1),s.applyImpulse(this.gameObject.worldForward.add({x:0,y:2,z:0}).normalize().multiplyScalar(.01)));const e=i==null?void 0:i.getComponentInChildren(C);if(e){const n=e.sharedMaterial.clone()||new Ee;n&&"map"in n&&(n.map=t,n.side=zi),e.sharedMaterial=n}})}}St([a(Oe)],it.prototype,"camera",2);St([a()],it.prototype,"width",2);St([a()],it.prototype,"height",2);St([a(Pe)],it.prototype,"prefab",2);var Qs=Object.defineProperty,Ys=Object.getOwnPropertyDescriptor,V=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ys(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Qs(t,i,e),e};class st extends h{constructor(){super(...arguments),this.logEvents=!1}onCollisionEnter(t){var i;this.logEvents&&console.log("ENTER",t),(i=this.onEnter)==null||i.invoke(t)}onCollisionStay(t){var i;this.logEvents&&console.log("STAY",t),(i=this.onStay)==null||i.invoke(t)}onCollisionExit(t){var i;this.logEvents&&console.log("EXIT",t),(i=this.onExit)==null||i.invoke(t)}}V([g(x)],st.prototype,"onEnter",2);V([g(x)],st.prototype,"onStay",2);V([g(x)],st.prototype,"onExit",2);V([g()],st.prototype,"logEvents",2);class rt extends h{onTriggerEnter(t){var i,s;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(s=this.onEnter)==null||s.invoke()}onTriggerStay(t){var i,s;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(s=this.onStay)==null||s.invoke()}onTriggerExit(t){var i,s;this.triggerObjects&&this.triggerObjects.length>0&&!((i=this.triggerObjects)!=null&&i.includes(t.gameObject))||(s=this.onExit)==null||s.invoke()}}V([g(m)],rt.prototype,"triggerObjects",2);V([g(x)],rt.prototype,"onEnter",2);V([g(x)],rt.prototype,"onStay",2);V([g(x)],rt.prototype,"onExit",2);var Zs=Object.defineProperty,ks=Object.getOwnPropertyDescriptor,Bs=(r,t,i,s)=>{for(var e=s>1?void 0:s?ks(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Zs(t,i,e),e};class He extends h{constructor(){super(...arguments),this._lastTriggerTime=0}onTriggerEnter(t){this.context.time.time-this._lastTriggerTime<.3||(this._lastTriggerTime=this.context.time.time,this.animation&&this.animation.play(0,{loop:!1}))}onTriggerExit(){}}Bs([g(vt)],He.prototype,"animation",2);var Xs=Object.defineProperty,Js=Object.getOwnPropertyDescriptor,tr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Js(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Xs(t,i,e),e};class Ge extends h{onTriggerEnter(){var t,i;(t=this.animation)!=null&&t.isPlaying||(i=this.animation)==null||i.play(0,{loop:!1})}}tr([g(vt)],Ge.prototype,"animation",2);var er=Object.defineProperty,ir=Object.getOwnPropertyDescriptor,sr=(r,t,i,s)=>{for(var e=s>1?void 0:s?ir(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&er(t,i,e),e};class qe extends h{onCollisionEnter(){var t,i;(t=this.audioSource)==null||t.stop(),(i=this.audioSource)==null||i.play()}}sr([g(H)],qe.prototype,"audioSource",2);class rr extends h{onEnable(){const t=m.findObjectOfType(wt);t==null||t.addEventListener("before-export",()=>{this.resetAnimations()})}onEnterXR(t){this.resetAnimations()}resetAnimations(){console.warn("Resetting animations and audio for XR export.");const t=m.findObjectsOfType(vt);for(const s of t)s.actions.forEach(e=>{e.reset(),e.time=0,e.play()});const i=m.findObjectsOfType(H);for(const s of i)s.stop(),s.play()}}var nr=Object.defineProperty,or=Object.getOwnPropertyDescriptor,Ke=(r,t,i,s)=>{for(var e=s>1?void 0:s?or(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&nr(t,i,e),e};class ae extends h{constructor(){super(...arguments),this.referenceSize=512,this.updateSize=()=>{if(this.content){if(this.referenceSize<=0)return console.error("ResponsiveContent: Base width must be greater than 0.");const t=this.context.domWidth/this.referenceSize;this.content.scale.set(t,t,t)}else J()&&console.warn("ResponsiveContent: No content object set.")}}onEnable(){window.addEventListener("resize",this.updateSize),this.updateSize()}onDisable(){window.removeEventListener("resize",this.updateSize)}}Ke([a(S)],ae.prototype,"content",2);Ke([a()],ae.prototype,"referenceSize",2);var ar=Object.defineProperty,lr=Object.getOwnPropertyDescriptor,le=(r,t,i,s)=>{for(var e=s>1?void 0:s?lr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&ar(t,i,e),e};class Qe extends h{async sceneOpened(){var t;(t=this.animator)==null||t.setBool("SceneOpen",!0),this._htmlElement=this._getHtmlElement(),this.context.domElement.appendChild(this._htmlElement)}async sceneClosing(){var t,i;await zt(1e3),(t=this.animator)==null||t.setBool("SceneOpen",!1),await zt(1e3),(i=this._htmlElement)==null||i.remove()}_getHtmlElement(){if(!this._htmlElement){this._htmlElement=document.createElement("div"),this._htmlElement.style.cssText=`
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                display: flex;
                justify-content: center;
                align-items: center;
                // backdrop-filter: blur(10px);
            `;const t=document.createElement("img");t.src="https://engine.needle.tools/branding/needle-logo.png",this._htmlElement.appendChild(t)}return this._htmlElement}}le([a(kt)],Qe.prototype,"animator",2);class he extends h{sceneOpened(){var t;return J()&&console.log("Scene opened",this.name),(t=this.opened)==null||t.invoke(),Promise.resolve()}sceneClosing(){var t;return J()&&console.log("Scene closing",this.name),(t=this.closing)==null||t.invoke(),Promise.resolve()}}le([a(x)],he.prototype,"opened",2);le([a(x)],he.prototype,"closing",2);class hr extends h{next(){var t;this.switcher??(this.switcher=this.get()),console.log(this.switcher),(t=this.switcher)==null||t.selectNext()}previous(){var t;this.switcher??(this.switcher=this.get()),(t=this.switcher)==null||t.selectPrev()}get(){return m.findObjectOfType(wi)}}class cr extends h{awake(){const t=this.gameObject.getComponent(C);if(t!=null&&t.sharedMaterials)for(const i of t.sharedMaterials)i&&(i.side=Wi)}}var pr=Object.defineProperty,dr=Object.getOwnPropertyDescriptor,mr=(r,t,i,s)=>{for(var e=s>1?void 0:s?dr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&pr(t,i,e),e};class Ye extends h{constructor(){super(...arguments),this.text=""}start(){f(this.text)}}mr([a()],Ye.prototype,"text",2);var ur=Object.defineProperty,fr=Object.getOwnPropertyDescriptor,gr=(r,t,i,s)=>{for(var e=s>1?void 0:s?fr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&ur(t,i,e),e};const br=j("testleaderboard");class qt extends h{constructor(){super(...arguments),this._ready=!1}get ready(){return this._ready}onEnable(){this.context.connection.beginListen(_i.JoinedRoom,async()=>{await zt(100),this.context.connection.tryGetState(this.guid)||(this.data={scores:[]}),this._ready=!0}),br?(console.log("Enabled test leaderboard, adding random scores"),setInterval(()=>{this.insertScore("Player",Math.floor(Math.random()*1e3))},2e3)):J()&&f("You can add ?testleaderboard to the url to test the leaderboard")}insertScore(t,i){if(!this._ready){console.warn("Cannot insert score, data not received yet");return}const s=10,e=this.data.scores;for(;e.length>=s;){this.sortScores();const n=e.pop();if(n.score>i){console.log(`Score ${i} is lower than ${n==null?void 0:n.score} (lowest score), ignoring`),e.push(n);return}}console.log("Inserting score",t,i),e.push({name:t,score:i}),this.sortScores(),this.data=this.data}sortScores(){this.data.scores.sort((t,i)=>i.score-t.score)}onDataChanged(t){if(console.warn("Data changed!",t,this.data.scores),this.data.scores.length>0){const i=this.data.scores[0];f("HIGHSCORE - "+i.name+": "+i.score)}this.dispatchEvent(new CustomEvent("changed",{detail:this.data}))}}gr([G(qt.prototype.onDataChanged)],qt.prototype,"data",2);var xr=Object.defineProperty,vr=Object.getOwnPropertyDescriptor,wr=(r,t,i,s)=>{for(var e=s>1?void 0:s?vr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&xr(t,i,e),e};class Ze extends h{start(){this.updateStartPosition();const t=m.findObjectOfType(wt);t&&t.addEventListener("before-export",()=>{this.resetToStart()})}updateStartPosition(){this.gameObject.updateMatrix(),this.startPosition=this.gameObject.position.clone(),this.startMatrix=this.gameObject.matrix.clone()}resetToStart(){if(!this.startPosition)return;const t=m.getComponent(this.gameObject,E);t==null||t.teleport(this.startPosition)}}class ke extends Ze{start(){super.start(),this.worldCollider||console.warn("Missing collider to reset",this)}onTriggerExit(t){t===this.worldCollider&&this.resetToStart()}createBehaviours(t,i,s){if(i.uuid!==this.gameObject.uuid||!this.startPosition||!this.startMatrix)return;const e=ft.createEmpty();this.gameObject.parent?e.matrix=this.gameObject.parent.matrixWorld.clone().multiply(this.startMatrix):e.matrix=this.startMatrix,s.document.add(e);const n=new L("_reset_"+this.name+"_afterTime",F.sceneStartTrigger(),_.sequence(_.waitAction(Math.random()*4+1),_.sequence(_.transformAction(this.gameObject,e,0,"absolute","none"),_.waitAction(5)).makeLooping())).makeExclusive(!0);t.addBehavior(n)}}wr([g(_t)],ke.prototype,"worldCollider",2);var _r=Object.defineProperty,Or=Object.getOwnPropertyDescriptor,yr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Or(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&_r(t,i,e),e};class Be extends h{constructor(){super(...arguments),this.roomId="",this.playerCount=0}update(){const t=this.context.connection;let i=!1;t.currentRoomName&&t.currentRoomName!==this.roomId&&(this.roomId=t.currentRoomName,i=!0),t.usersInRoom().length!==this.playerCount&&(this.playerCount=t.usersInRoom().length,i=!0),i&&this.connectionLabel&&(this.connectionLabel.text=`Room: ${this.roomId}
Users: ${this.playerCount}
Your id: ${t.connectionId}`)}}yr([a(U)],Be.prototype,"connectionLabel",2);var Pr=Object.defineProperty,Cr=Object.getOwnPropertyDescriptor,jr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Cr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Pr(t,i,e),e};class Xe extends h{constructor(){super(...arguments),this.interval=1e3,this.max=100,this.spawned=0}awake(){if(!this.object){console.warn("TimedSpawn: no object to spawn"),f("TimedSpawn: no object to spawn",Ce.Warn);return}m.setActive(this.object,!1),this.startCoroutine(this.spawn())}*spawn(){if(this.object)for(;this.spawned<this.max;){const t=m.instantiate(this.object);m.setActive(t,!0),this.spawned+=1,yield Oi(this.interval/1e3)}}}jr([g(m)],Xe.prototype,"object",2);var Sr=Object.defineProperty,Dr=Object.getOwnPropertyDescriptor,Tr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Dr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Sr(t,i,e),e};class Je extends h{constructor(){super(...arguments),this.onlyMobile=!1}awake(){if(this.onlyMobile&&!yi())return;const t=this.gameObject.getComponent(Pi);t&&(t.position="top")}}Tr([a()],Je.prototype,"onlyMobile",2);class Er extends h{constructor(){super(...arguments),this._video=null}async onEnable(){this._video??(this._video=document.createElement("video")),this._video.style.cssText=`
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            object-fit: cover;
        `,this.context.domElement.shadowRoot.appendChild(this._video);const t=await navigator.mediaDevices.getUserMedia({video:!0});!t||!this.enabled||(this._video.srcObject=t,this._video.play())}onDisable(){var t,i;(t=this._video)==null||t.pause(),(i=this._video)==null||i.remove()}}var Mr=Object.defineProperty,Ar=Object.getOwnPropertyDescriptor,Dt=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ar(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Mr(t,i,e),e};class nt extends h{constructor(){super(...arguments),this.interval=3,this.resetPosition=!0,this.resetRotation=!1,this.resetVelocity=!1}start(){const t=this.gameObject.position.clone(),i=this.gameObject.rotation.clone(),s=this.gameObject.getComponent(E),e=this.context.time.frame;setInterval(()=>{this.resetPosition&&this.gameObject.position.copy(t),this.resetRotation&&this.gameObject.rotation.copy(i),s&&this.resetVelocity&&this.context.time.frame!==e&&s.resetVelocities()},this.interval*1e3)}}Dt([a()],nt.prototype,"interval",2);Dt([a()],nt.prototype,"resetPosition",2);Dt([a()],nt.prototype,"resetRotation",2);Dt([a()],nt.prototype,"resetVelocity",2);class $r extends h{constructor(){super(...arguments),this.toggleRendererOnly=!1}start(){setInterval(()=>{if(f('This is a sample for showing how to <a href="https://engine.needle.tools/docs/scripting.html#component-architecture" target="_blank">toggle visibility of a GameObject</a>'),this.toggleRendererOnly){const t=this.gameObject.getComponent(C);t&&(t.enabled=!t.enabled)}else this.gameObject.visible=!this.gameObject.visible},1e3)}}var Ir=Object.defineProperty,Lr=Object.getOwnPropertyDescriptor,Fr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Lr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Ir(t,i,e),e};class ti extends h{awake(){this.material&&(this.material.wireframe=!0)}}Fr([a(Me)],ti.prototype,"material",2);var Vr=Object.defineProperty,Nr=Object.getOwnPropertyDescriptor,ei=(r,t,i,s)=>{for(var e=s>1?void 0:s?Nr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Vr(t,i,e),e};class ce extends h{constructor(){super(...arguments),this.onSessionStart=new x,this.onSessionEnd=new x}onEnterXR(t){this.onWebXRStarted()}onExitXR(t){this.onWebXREnded()}onWebXRStarted(){this.onSessionStart.invoke()}onWebXREnded(){this.onSessionEnd.invoke()}}ei([a(x)],ce.prototype,"onSessionStart",2);ei([a(x)],ce.prototype,"onSessionEnd",2);const ut=j("debugbodytracking");class Ur extends h{constructor(){super(...arguments),this.jointPositions=new Map,this.size=new P(.01,.01,.01),this.hasWarnedForName=new Set}onEnable(){ut&&console.log(we.join(`
`))}onBeforeXR(t,i){i.optionalFeatures=i.optionalFeatures||[],i.optionalFeatures.includes("body-tracking")||i.optionalFeatures.push("body-tracking")}onUpdateXR(t){const i=t.xr.frame;if(!i)return;const s=t.xr.rig.gameObject,e=this.context.renderer.xr.getReferenceSpace();if(i.session&&"body"in i&&e){const n=i.body;if(!n)return;n.forEach(o=>{const l=i.getPose(o,e);if(!l)return;const p=l.transform.position,d=v();d.copy(p),d.x*=-1,d.z*=-1,s.localToWorld(d);const u=o.jointName;this.jointPositions.has(u)||this.jointPositions.set(u,new P),this.jointPositions.get(u).copy(d),ut&&I.DrawWireBox(d,this.size,16711680,void 0,!1);const y=v();y.copy(p),y.x*=-1,s.localToWorld(y);const $=o.jointName+"-flipped";this.jointPositions.has($)||this.jointPositions.set($,new P),this.jointPositions.get($).copy(y),ut&&I.DrawWireBox(y,this.size,65280,void 0,!1);const W=we.indexOf(u);ut&&I.DrawLabel(y,W.toString(),.015,void 0,16777215,85),W<0&&(this.hasWarnedForName.has(u)||(this.hasWarnedForName.add(u),console.warn("Wrong name: "+u+" -> "+W+". Please report a bug.")))});for(const o of zr){const l=this.jointPositions.get(o.from),p=this.jointPositions.get(o.to);if(l&&p){I.DrawLine(l,p,16776960,void 0,!1);const d=this.jointPositions.get(o.from+"-flipped"),u=this.jointPositions.get(o.to+"-flipped");d&&u&&I.DrawLine(d,u,65535,void 0,!1)}}}}}var ii=(r=>(r[r.root=0]="root",r[r.hips=1]="hips",r[r["spine-lower"]=2]="spine-lower",r[r["spine-middle"]=3]="spine-middle",r[r["spine-upper"]=4]="spine-upper",r[r.chest=5]="chest",r[r.neck=6]="neck",r[r.head=7]="head",r[r["left-shoulder"]=8]="left-shoulder",r[r["left-scapula"]=9]="left-scapula",r[r["left-arm-upper"]=10]="left-arm-upper",r[r["left-arm-lower"]=11]="left-arm-lower",r[r["left-hand-wrist-twist"]=12]="left-hand-wrist-twist",r[r["right-shoulder"]=13]="right-shoulder",r[r["right-scapula"]=14]="right-scapula",r[r["right-arm-upper"]=15]="right-arm-upper",r[r["right-arm-lower"]=16]="right-arm-lower",r[r["right-hand-wrist-twist"]=17]="right-hand-wrist-twist",r[r["left-hand-palm"]=18]="left-hand-palm",r[r["left-hand-wrist"]=19]="left-hand-wrist",r[r["left-hand-thumb-metacarpal"]=20]="left-hand-thumb-metacarpal",r[r["left-hand-thumb-phalanx-proximal"]=21]="left-hand-thumb-phalanx-proximal",r[r["left-hand-thumb-phalanx-distal"]=22]="left-hand-thumb-phalanx-distal",r[r["left-hand-thumb-tip"]=23]="left-hand-thumb-tip",r[r["left-hand-index-metacarpal"]=24]="left-hand-index-metacarpal",r[r["left-hand-index-phalanx-proximal"]=25]="left-hand-index-phalanx-proximal",r[r["left-hand-index-phalanx-intermediate"]=26]="left-hand-index-phalanx-intermediate",r[r["left-hand-index-phalanx-distal"]=27]="left-hand-index-phalanx-distal",r[r["left-hand-index-tip"]=28]="left-hand-index-tip",r[r["left-hand-middle-phalanx-metacarpal"]=29]="left-hand-middle-phalanx-metacarpal",r[r["left-hand-middle-phalanx-proximal"]=30]="left-hand-middle-phalanx-proximal",r[r["left-hand-middle-phalanx-intermediate"]=31]="left-hand-middle-phalanx-intermediate",r[r["left-hand-middle-phalanx-distal"]=32]="left-hand-middle-phalanx-distal",r[r["left-hand-middle-tip"]=33]="left-hand-middle-tip",r[r["left-hand-ring-metacarpal"]=34]="left-hand-ring-metacarpal",r[r["left-hand-ring-phalanx-proximal"]=35]="left-hand-ring-phalanx-proximal",r[r["left-hand-ring-phalanx-intermediate"]=36]="left-hand-ring-phalanx-intermediate",r[r["left-hand-ring-phalanx-distal"]=37]="left-hand-ring-phalanx-distal",r[r["left-hand-ring-tip"]=38]="left-hand-ring-tip",r[r["left-hand-little-metacarpal"]=39]="left-hand-little-metacarpal",r[r["left-hand-little-phalanx-proximal"]=40]="left-hand-little-phalanx-proximal",r[r["left-hand-little-phalanx-intermediate"]=41]="left-hand-little-phalanx-intermediate",r[r["left-hand-little-phalanx-distal"]=42]="left-hand-little-phalanx-distal",r[r["left-hand-little-tip"]=43]="left-hand-little-tip",r[r["right-hand-palm"]=44]="right-hand-palm",r[r["right-hand-wrist"]=45]="right-hand-wrist",r[r["right-hand-thumb-metacarpal"]=46]="right-hand-thumb-metacarpal",r[r["right-hand-thumb-phalanx-proximal"]=47]="right-hand-thumb-phalanx-proximal",r[r["right-hand-thumb-phalanx-distal"]=48]="right-hand-thumb-phalanx-distal",r[r["right-hand-thumb-tip"]=49]="right-hand-thumb-tip",r[r["right-hand-index-metacarpal"]=50]="right-hand-index-metacarpal",r[r["right-hand-index-phalanx-proximal"]=51]="right-hand-index-phalanx-proximal",r[r["right-hand-index-phalanx-intermediate"]=52]="right-hand-index-phalanx-intermediate",r[r["right-hand-index-phalanx-distal"]=53]="right-hand-index-phalanx-distal",r[r["right-hand-index-tip"]=54]="right-hand-index-tip",r[r["right-hand-middle-metacarpal"]=55]="right-hand-middle-metacarpal",r[r["right-hand-middle-phalanx-proximal"]=56]="right-hand-middle-phalanx-proximal",r[r["right-hand-middle-phalanx-intermediate"]=57]="right-hand-middle-phalanx-intermediate",r[r["right-hand-middle-phalanx-distal"]=58]="right-hand-middle-phalanx-distal",r[r["right-hand-middle-tip"]=59]="right-hand-middle-tip",r[r["right-hand-ring-metacarpal"]=60]="right-hand-ring-metacarpal",r[r["right-hand-ring-phalanx-proximal"]=61]="right-hand-ring-phalanx-proximal",r[r["right-hand-ring-phalanx-intermediate"]=62]="right-hand-ring-phalanx-intermediate",r[r["right-hand-ring-phalanx-distal"]=63]="right-hand-ring-phalanx-distal",r[r["right-hand-ring-tip"]=64]="right-hand-ring-tip",r[r["right-hand-little-metacarpal"]=65]="right-hand-little-metacarpal",r[r["right-hand-little-phalanx-proximal"]=66]="right-hand-little-phalanx-proximal",r[r["right-hand-little-phalanx-intermediate"]=67]="right-hand-little-phalanx-intermediate",r[r["right-hand-little-phalanx-distal"]=68]="right-hand-little-phalanx-distal",r[r["right-hand-little-tip"]=69]="right-hand-little-tip",r[r["left-upper-leg"]=70]="left-upper-leg",r[r["left-lower-leg"]=71]="left-lower-leg",r[r["left-foot-ankle-twist"]=72]="left-foot-ankle-twist",r[r["left-foot-ankle"]=73]="left-foot-ankle",r[r["left-foot-subtalar"]=74]="left-foot-subtalar",r[r["left-foot-transverse"]=75]="left-foot-transverse",r[r["left-foot-ball"]=76]="left-foot-ball",r[r["right-upper-leg"]=77]="right-upper-leg",r[r["right-lower-leg"]=78]="right-lower-leg",r[r["right-foot-ankle-twist"]=79]="right-foot-ankle-twist",r[r["right-foot-ankle"]=80]="right-foot-ankle",r[r["right-foot-subtalar"]=81]="right-foot-subtalar",r[r["right-foot-transverse"]=82]="right-foot-transverse",r[r["right-foot-ball"]=83]="right-foot-ball",r))(ii||{});const we=Object.values(ii),zr=[{from:"hips",to:"spine-lower"},{from:"spine-lower",to:"spine-middle"},{from:"spine-middle",to:"spine-upper"},{from:"spine-upper",to:"chest"},{from:"chest",to:"neck"},{from:"neck",to:"head"},{from:"chest",to:"left-shoulder"},{from:"left-shoulder",to:"left-scapula"},{from:"left-scapula",to:"left-arm-upper"},{from:"left-arm-upper",to:"left-arm-lower"},{from:"left-arm-lower",to:"left-hand-wrist-twist"},{from:"left-hand-wrist-twist",to:"left-hand-wrist"},{from:"left-hand-wrist",to:"left-hand-palm"},{from:"left-hand-wrist",to:"left-hand-thumb-metacarpal"},{from:"left-hand-thumb-metacarpal",to:"left-hand-thumb-phalanx-proximal"},{from:"left-hand-thumb-phalanx-proximal",to:"left-hand-thumb-phalanx-distal"},{from:"left-hand-thumb-phalanx-distal",to:"left-hand-thumb-tip"},{from:"left-hand-wrist",to:"left-hand-index-metacarpal"},{from:"left-hand-index-metacarpal",to:"left-hand-index-phalanx-proximal"},{from:"left-hand-index-phalanx-proximal",to:"left-hand-index-phalanx-intermediate"},{from:"left-hand-index-phalanx-intermediate",to:"left-hand-index-phalanx-distal"},{from:"left-hand-index-phalanx-distal",to:"left-hand-index-tip"},{from:"left-hand-wrist",to:"left-hand-middle-phalanx-metacarpal"},{from:"left-hand-middle-phalanx-metacarpal",to:"left-hand-middle-phalanx-proximal"},{from:"left-hand-middle-phalanx-proximal",to:"left-hand-middle-phalanx-intermediate"},{from:"left-hand-middle-phalanx-intermediate",to:"left-hand-middle-phalanx-distal"},{from:"left-hand-middle-phalanx-distal",to:"left-hand-middle-tip"},{from:"left-hand-wrist",to:"left-hand-ring-metacarpal"},{from:"left-hand-ring-metacarpal",to:"left-hand-ring-phalanx-proximal"},{from:"left-hand-ring-phalanx-proximal",to:"left-hand-ring-phalanx-intermediate"},{from:"left-hand-ring-phalanx-intermediate",to:"left-hand-ring-phalanx-distal"},{from:"left-hand-ring-phalanx-distal",to:"left-hand-ring-tip"},{from:"left-hand-wrist",to:"left-hand-little-metacarpal"},{from:"left-hand-little-metacarpal",to:"left-hand-little-phalanx-proximal"},{from:"left-hand-little-phalanx-proximal",to:"left-hand-little-phalanx-intermediate"},{from:"left-hand-little-phalanx-intermediate",to:"left-hand-little-phalanx-distal"},{from:"left-hand-little-phalanx-distal",to:"left-hand-little-tip"},{from:"chest",to:"right-shoulder"},{from:"right-shoulder",to:"right-scapula"},{from:"right-scapula",to:"right-arm-upper"},{from:"right-arm-upper",to:"right-arm-lower"},{from:"right-arm-lower",to:"right-hand-wrist-twist"},{from:"right-hand-wrist-twist",to:"right-hand-wrist"},{from:"right-hand-wrist",to:"right-hand-palm"},{from:"right-hand-wrist",to:"right-hand-thumb-metacarpal"},{from:"right-hand-thumb-metacarpal",to:"right-hand-thumb-phalanx-proximal"},{from:"right-hand-thumb-phalanx-proximal",to:"right-hand-thumb-phalanx-distal"},{from:"right-hand-thumb-phalanx-distal",to:"right-hand-thumb-tip"},{from:"right-hand-wrist",to:"right-hand-index-metacarpal"},{from:"right-hand-index-metacarpal",to:"right-hand-index-phalanx-proximal"},{from:"right-hand-index-phalanx-proximal",to:"right-hand-index-phalanx-intermediate"},{from:"right-hand-index-phalanx-intermediate",to:"right-hand-index-phalanx-distal"},{from:"right-hand-index-phalanx-distal",to:"right-hand-index-tip"},{from:"right-hand-wrist",to:"right-hand-middle-metacarpal"},{from:"right-hand-middle-metacarpal",to:"right-hand-middle-phalanx-proximal"},{from:"right-hand-middle-phalanx-proximal",to:"right-hand-middle-phalanx-intermediate"},{from:"right-hand-middle-phalanx-intermediate",to:"right-hand-middle-phalanx-distal"},{from:"right-hand-middle-phalanx-distal",to:"right-hand-middle-tip"},{from:"right-hand-wrist",to:"right-hand-ring-metacarpal"},{from:"right-hand-ring-metacarpal",to:"right-hand-ring-phalanx-proximal"},{from:"right-hand-ring-phalanx-proximal",to:"right-hand-ring-phalanx-intermediate"},{from:"right-hand-ring-phalanx-intermediate",to:"right-hand-ring-phalanx-distal"},{from:"right-hand-ring-phalanx-distal",to:"right-hand-ring-tip"},{from:"right-hand-wrist",to:"right-hand-little-metacarpal"},{from:"right-hand-little-metacarpal",to:"right-hand-little-phalanx-proximal"},{from:"right-hand-little-phalanx-proximal",to:"right-hand-little-phalanx-intermediate"},{from:"right-hand-little-phalanx-intermediate",to:"right-hand-little-phalanx-distal"},{from:"right-hand-little-phalanx-distal",to:"right-hand-little-tip"},{from:"hips",to:"left-upper-leg"},{from:"left-upper-leg",to:"left-lower-leg"},{from:"left-lower-leg",to:"left-foot-ankle-twist"},{from:"left-foot-ankle-twist",to:"left-foot-ankle"},{from:"left-foot-ankle",to:"left-foot-subtalar"},{from:"left-foot-subtalar",to:"left-foot-transverse"},{from:"left-foot-transverse",to:"left-foot-ball"},{from:"hips",to:"right-upper-leg"},{from:"right-upper-leg",to:"right-lower-leg"},{from:"right-lower-leg",to:"right-foot-ankle-twist"},{from:"right-foot-ankle-twist",to:"right-foot-ankle"},{from:"right-foot-ankle",to:"right-foot-subtalar"},{from:"right-foot-subtalar",to:"right-foot-transverse"},{from:"right-foot-transverse",to:"right-foot-ball"}];var Wr=Object.defineProperty,Rr=Object.getOwnPropertyDescriptor,Hr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Rr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Wr(t,i,e),e};class pe extends h{constructor(){super(...arguments),this.destroyTarget=!1,this._startTime=0}awake(){if(this._rigidbody=this.gameObject.getComponentInParent(E)||void 0,this._rigidbody){const t=this.gameObject.getComponentsInChildren(_t);for(const i of t){const s=m.addComponent(i.gameObject,Gr);s.rigidBody=this._rigidbody,s.arrow=this,s.audioOnImpact=this.audioOnImpact,s.destroyTarget=this.destroyTarget}}this._startTime=this.context.time.time}onBeforeRender(){if(this.context.time.time-this._startTime>5){this.gameObject.destroy();return}if(this._rigidbody){const t=this._rigidbody.getVelocity();if(t.lengthSq()>0){const i=v().set(t.x,t.y,t.z).normalize(),s=Ci();s.setFromUnitVectors(v(0,0,1),i),this.gameObject.quaternion.copy(s)}}}}Hr([a(H)],pe.prototype,"audioOnImpact",2);class Gr extends h{constructor(){super(...arguments),this.destroyTarget=!1}onCollisionEnter(t){var i,s;if(this.arrow)if((i=this.audioOnImpact)==null||i.stop(),(s=this.audioOnImpact)==null||s.play(),this.destroyTarget)t.gameObject.destroy(),this.arrow.gameObject.destroy();else{t.gameObject.attach(this.arrow.gameObject),t.rigidBody instanceof E&&t.rigidBody.applyImpulse(t.gameObject.position.clone().multiply(this.rigidBody.getVelocity()),!0);const e=this.rigidBody.gameObject.getComponentsInChildren(_t);for(const n of e)n.destroy();this.rigidBody.destroy(),this.arrow.destroy()}}}var qr=Object.defineProperty,Kr=Object.getOwnPropertyDescriptor,M=(r,t,i,s)=>{for(var e=s>1?void 0:s?Kr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&qr(t,i,e),e};const _e=j("debugarrow");class D extends h{constructor(){super(...arguments),this.power=1.5,this.drawMaxPhysicalDistance=.47269,this.drawMinPhysicalDistance=.1132593,this._tempLookMatrix=new Ri,this._tempLookRot=new Wt,this._lastShotTimestamp=Number.MIN_SAFE_INTEGER,this._isAiming=!1,this._bowController=void 0,this._stringController=void 0,this._controllerFollow=null,this._aimingPointerStartPos=new P,this._initialBowObjectRotation=new Wt,this._initialBowObjectPosition=new P,this._screenDragRaycaster=new Hi,this._screenDragPlane=new Gi,this._screenDragRayLine=new qi,this.onDown=t=>{t.origin instanceof ge?t.button===0&&(this._bowController===void 0?(this._bowController=t.origin.index,this.bowObject.quaternion.copy(this._initialBowObjectRotation)):this._stringController===void 0&&(this._stringController=t.origin.index),this._bowController===this._stringController&&(this._stringController=void 0),this._controllerFollow&&(this._controllerFollow.side=this._bowController,this._controllerFollow.enabled=this._bowController!==void 0),this._isAiming=this._stringController!==void 0):t.button===0&&(this._isAiming=!0,this._stringPointerId=t.pointerId,this.getScreenDragPoint(t.pointerId,this._aimingPointerStartPos))},this.onRelease=t=>{var i;if(t.button===0){if(t.origin instanceof ge){const s=t.origin;if(this._isAiming&&s.index===this._stringController&&s.index!==this._bowController&&typeof this._bowController=="number"){const e=(i=R.active)==null?void 0:i.getController(this._bowController);if(s&&e){const n=s.gripWorldPosition;if(n){const o=e.gripWorldPosition.clone().sub(n);let l=e.object.worldPosition.distanceTo(s.object.worldPosition);l-=this.drawMinPhysicalDistance;const p=b.clamp01(l/this.drawMaxPhysicalDistance)*this.power;o.normalize().multiplyScalar(p),this.shoot(n,o),_e&&I.DrawArrow(n,o.clone().add(n),16776960,1)}}}s.index===this._bowController&&(this._bowController=void 0),s.index===this._stringController&&(this._stringController=void 0),this._isAiming=this._bowController!==void 0&&this._stringController!==void 0,this._controllerFollow&&(this._controllerFollow.enabled=this._bowController!==void 0)}else{const s=this._aimingPointerStartPos,e=this.getScreenDragPoint(this._stringPointerId,v()),n=this.arrowSpawnSpot.getWorldPosition(v()),o=this.bowObject.getWorldDirection(v()).multiplyScalar(-1),l=s.distanceTo(e),p=b.clamp01(l/this.drawMaxPhysicalDistance)*this.power;o.normalize().multiplyScalar(p),this.shoot(n,o)}this._stringPointerId=void 0}}}get _hasControllers(){var t;return(((t=this.context.xr)==null?void 0:t.controllers.length)??0)>0}awake(){var t;(t=this.arrowPrefab)!=null&&t.asset&&(this.arrowPrefab.asset.visible=!1)}async onEnable(){var t;await((t=this.arrowPrefab)==null?void 0:t.loadAssetAsync()),this._isAiming=!1,this._controllerFollow=this.bowObject.getComponentInParent(Si)||null,this._initialBowObjectRotation=this.bowObject.quaternion.clone(),this._initialBowObjectPosition=this.bowObject.position.clone(),this._screenDragPlane.setFromNormalAndCoplanarPoint(v(0,1,-.2),this.bowObject.worldPosition),this.context.input.addEventListener("pointerdown",this.onDown),this.context.input.addEventListener("pointerup",this.onRelease),this.setupArrowInstances()}onDisable(){this._isAiming=!1,this.context.input.removeEventListener("pointerdown",this.onDown),this.context.input.removeEventListener("pointerup",this.onRelease)}onLeaveXR(){this.bowObject.quaternion.copy(this._initialBowObjectRotation),this.bowObject.position.copy(this._initialBowObjectPosition)}getPointerDistanceTo(t,i){const s=this.context.input.getPointerPosition(i);return t.distanceTo(s)}async setupArrowInstances(){var i,s,e;if(!this.arrowPrefab||!this.arrowSpawnSpot||this._drawingArrow)return;const t=await this.arrowPrefab.instantiate({parent:this.arrowSpawnSpot});t&&(t.visible=!0,t.worldScale=v(1,1,1),this._drawingArrow=t,(i=t.getComponent(pe))==null||i.destroy(),(s=t.getComponent(E))==null||s.destroy(),(e=t.getComponentInChildren(Yt))==null||e.destroy(),t.getComponentsInChildren(_t).forEach(n=>n.destroy()))}async shoot(t,i){var d,u;if(!this.arrowPrefab)return;this._lastShotTimestamp=this.context.time.time;const s=t.clone(),e=s.clone().add(i),n=Math.pow(i.length()+.5,2),o=i.clone().normalize(),l=await this.arrowPrefab.instantiate({parent:this.context.scene});if(!l){console.error("Failed to instantiate arrow prefab, please check that objects are assigned correctly.");return}l.worldPosition=s,l.lookAt(e),l.visible=!0;const p=l.getComponent(E);p&&(p.isKinematic=!1,p.autoMass=!1,p.mass=.05,(d=this.sound)==null||d.stop(),(u=this.sound)==null||u.play(),await Bt(1),p.applyImpulse(o.multiplyScalar(n),!0))}getScreenDragPoint(t,i){const s=this.context.input.getPointerPositionRC(t);this._screenDragRaycaster.setFromCamera(s,this.context.mainCamera);const e=this._screenDragRaycaster.ray;return this._screenDragRayLine.set(e.origin,e.direction.multiplyScalar(1e5)),this._screenDragPlane.intersectLine(this._screenDragRayLine,i)||i.set(0,0,0),_e&&I.DrawWireSphere(i,.01,16711680,1),i}onBeforeRender(){if(!this.animationComponent||!this.bowObject)return;if(!this._mixer){this._mixer=new Ki(this.bowObject);const p=this.animationComponent.animations.at(0);p&&(this._animation=this._mixer.clipAction(p))}const t=.1;let i=0;const s=v(),e=v(),n=v(this.bowObject.worldUp);if(this._hasControllers){if(!this._isAiming)i=0,this._lastShotTimestamp=this.context.time.time;else if(this.context.xr&&this.context.xr.controllers.length>1&&this._bowController!==void 0&&this._stringController!==void 0){const p=this.context.xr.controllers[this._stringController],d=this.context.xr.controllers[this._bowController];if(!p||!d)return;s.copy(p.gripWorldPosition),e.copy(d.gripWorldPosition)}}else this._stringPointerId!==void 0&&(e.copy(this._aimingPointerStartPos),s.copy(this.getScreenDragPoint(this._stringPointerId,v())));if(this._isAiming&&s.dot(s)>0&&e.dot(e)>0){let p=s.distanceTo(e);i=b.clamp01((p-this.drawMinPhysicalDistance)/this.drawMaxPhysicalDistance),p>.025&&(this._tempLookMatrix.lookAt(s,e,n),this._tempLookRot.setFromRotationMatrix(this._tempLookMatrix),this.bowObject.worldQuaternion=this._tempLookRot)}this.drawProgression&&(i=this.drawProgression.evaluate(i)),!this._isAiming&&!this._hasControllers&&(i=.25),this._animation.timeScale=0;const o=b.lerp(this._animation.time,i,this.context.time.deltaTime/t),l=this._animation.time;if(this._animation.time=o,Math.abs(o-l)>Number.EPSILON&&(this._animation.setEffectiveWeight(1),this._animation.play()),this._mixer.update(this.context.time.deltaTime),this._drawingArrow){let d=(this.context.time.time-this._lastShotTimestamp)/.3;d=this.easeInOutSine(b.clamp01(d)),this._drawingArrow.worldScale=v(1,1,1).multiplyScalar(d)}}easeInOutSine(t){return b.clamp01(-.5*(Math.cos(Math.PI*t)-1))}}M([a(S)],D.prototype,"bowObject",2);M([a(vt)],D.prototype,"animationComponent",2);M([a(Pe)],D.prototype,"arrowPrefab",2);M([a(S)],D.prototype,"arrowSpawnSpot",2);M([a()],D.prototype,"power",2);M([a(ji)],D.prototype,"drawProgression",2);M([a()],D.prototype,"drawMaxPhysicalDistance",2);M([a()],D.prototype,"drawMinPhysicalDistance",2);M([a(H)],D.prototype,"sound",2);var Qr=Object.defineProperty,Yr=Object.getOwnPropertyDescriptor,Zr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Yr(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Qr(t,i,e),e};class si extends h{start(){this._meshRenderer=this.gameObject.getComponentInChildren(Di)}onDestroy(){if(this.gameObject.visible&&this.particleSystem){if(this.particleSystem.shape.shapeType===Ft.MeshRenderer&&this._meshRenderer&&!je(this._meshRenderer.gameObject)){this.particleSystem.shape.shapeType=Ft.MeshRenderer,this.particleSystem.shape.setMesh(this._meshRenderer),this.particleSystem.play();return}this.particleSystem.shape.shapeType=Ft.Sphere,this.particleSystem.worldPosition=this.gameObject.worldPosition,this.particleSystem.play()}}}Zr([a(Yt)],si.prototype,"particleSystem",2);var kr=Object.defineProperty,Br=Object.getOwnPropertyDescriptor,Xr=(r,t,i,s)=>{for(var e=s>1?void 0:s?Br(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&kr(t,i,e),e};class ri extends h{constructor(){super(...arguments),this._instances=new Array}awake(){var t,i;if(!((t=this.prefabs)!=null&&t.length)||((i=this.prefabs)==null?void 0:i.length)===0){console.warn("BowTargetSpawner start: no prefab set"),this.enabled=!1;return}this.prefabs.forEach(s=>s.visible=!1)}update(){var i;if(!((i=this.prefabs)!=null&&i.length))return;const t=v();for(let s=this._instances.length-1;s>=0;s--){const e=this._instances[s];je(e.instance)?this._instances.splice(s,1):(t.setScalar(e.scale),e.instance.scale.lerp(t,this.context.time.deltaTime))}if(this.context.time.frame%20===0&&Math.random()>.5){const s=this.worldPosition;s.x+=Math.random()*12-6,s.y+=Math.random()*3,s.z+=Math.random()*6;const e=Math.random()*3+.5,n=this.prefabs[Math.floor(Math.random()*this.prefabs.length)],o=Ti(n,{parent:this.scene,position:s.clone(),scale:new P(.01,.01,.01),keepWorldPosition:!0});o.visible=!0,this._instances.push({instance:o,scale:e}),setTimeout(()=>{o.destroy()},7e3),Bt(1).then(()=>{const l=o.getComponentInChildren(E);l&&(l.gravityScale=.2+Math.random()*.3,l.mass=2,l.autoMass=!1),l==null||l.setAngularVelocity(b.random(-2,2),b.random(-2,2),b.random(-2,2)),l==null||l.applyImpulse({x:0,y:5+Math.random()*12,z:0})})}}}Xr([a(S)],ri.prototype,"prefabs",2);class Jr extends h{awake(){this.context.renderer.toneMapping=Qi,ve.occlusion_fragment=ve.occlusion_fragment.replace("gl_FragColor *= 1.0 - occlusion;",`
float depthMm = Depth_GetCameraDepthInMeters(depthColor, depthUv, arrayIndex);

// requires also patching ShaderChunk.occlusion_pars_fragment and adding some noise function
// float noise = snoise(gl_FragCoord.xy * 0.005);
// depthMm += noise * 0.002;

float absDistance = abs(assetDepthM - depthMm);
float v = 0.0025;
absDistance = saturate(v - absDistance) / v;

gl_FragColor.rgb += vec3(absDistance * 2.0, absDistance * 2.0, absDistance * 12.0);
gl_FragColor = mix(gl_FragColor, vec4(0.0, 0.0, 0.0, 0.0), occlusion * 0.7);
`)}}class tn extends h{constructor(){super(...arguments),this.interval=-1,this.supportsAR=!1,this.supportsVR=!1}async onEnable(){this.log(!0),this.interval=setInterval(()=>this.log(),500),this.supportsAR=await R.isARSupported(),this.supportsVR=await R.isVRSupported()}onDisable(){clearInterval(this.interval)}async log(t=!1){t&&(console.log("UserAgent",window.navigator.userAgent),console.log("isMobileDevice",w.isMobileDevice()),console.log("isiOSDevice",w.isiOS()),console.log("isMozillaXR",w.isMozillaXR()),console.log("isSafari",w.isSafari()),console.log("isQuest",w.isQuest()),console.log("isMacOS",w.isMacOS()),console.log("isVisionOS",w.isVisionOS())),f("AR: "+i(this.supportsAR)+", VR: "+i(this.supportsVR)+", QuickLook: "+i(w.supportsQuickLookAR())),w.isMobileDevice()?w.isiOS()?f("iOS 🍎"):window.navigator.userAgent.indexOf("Android")>-1?f("Android 🤖"):f("Other Mobile 📱"):w.isDesktop()?f("Desktop 🖥️"):f("Other Device 🌏"),w.isMobileDevice()&&w.isiOS()&&w.isSafari()?f("Safari 🌏"):w.isMozillaXR()?f("Mozilla XR 🦊"):w.isQuest()?f("Quest 🎮"):window.navigator.userAgent.indexOf("Chrome")>-1?f("Chrome 🌏"):f("Other Browser 🌏"),f("UserAgent: "+window.navigator.userAgent);function i(s){return s?"✅":"❌"}}}class en extends h{onEnable(){const t=m.findObjectOfType(wt);t&&(t.anchoringType="plane",t.planeAnchoringAlignment="vertical")}}var sn=Object.defineProperty,rn=Object.getOwnPropertyDescriptor,ot=(r,t,i,s)=>{for(var e=s>1?void 0:s?rn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&sn(t,i,e),e};class q extends h{constructor(){super(...arguments),this.distance=.5,this.fadeDuration=1,this.targetState=!0,this.hideOnStart=!0,this.tempVector=new P}start(){this.hideOnStart&&!w.isiOS()&&this.target.scale.set(0,0,0)}update(){this.tempVector.copy(this.context.mainCameraComponent.worldPosition),this.tempVector.sub(this.worldPosition).length()<this.distance&&(this.enabled=!1)}createBehaviours(t,i,s){if(i.uuid===this.gameObject.uuid){const e=this.target?this.target:this.gameObject;this.hideOnStart&&t.addBehavior(new L("SetActiveOnProximity_active_"+this.gameObject.name,F.sceneStartTrigger(),_.fadeAction(e,0,!this.targetState))),t.addBehavior(new L("SetActiveOnProximity_"+this.gameObject.name,F.proximityToCameraTrigger(this.gameObject,this.distance),_.fadeAction(e,this.fadeDuration,this.targetState)))}}}ot([a(m)],q.prototype,"target",2);ot([a()],q.prototype,"distance",2);ot([a()],q.prototype,"fadeDuration",2);ot([a()],q.prototype,"targetState",2);ot([a()],q.prototype,"hideOnStart",2);var nn=Object.defineProperty,on=Object.getOwnPropertyDescriptor,de=(r,t,i,s)=>{for(var e=s>1?void 0:s?on(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&nn(t,i,e),e};class Tt extends h{constructor(){super(...arguments),this.getCloseClip="",this.distance=.5,this.lastDistance=void 0}update(){const t=this.gameObject.worldPosition.distanceTo(this.context.mainCameraComponent.worldPosition);this.lastDistance!==void 0&&t<this.distance&&this.lastDistance>=this.distance&&this.target.play(this.getCloseClip),this.lastDistance=t}createBehaviours(t,i,s){if(i.uuid===this.gameObject.uuid){const e=this.target?this.target.gameObject:this.gameObject,n=s.extensions.find(p=>p instanceof Ei);if(!n){console.warn("No AnimationExtension found",s.extensions);return}let o;const l=be.getAndRegisterAnimationSequences(n,e,this.getCloseClip);if(l)o=be.getActionForSequences(e,l.animationSequence,l.animationLoopAfterSequence,l.randomTimeOffset);else{console.warn("No animation sequence found for "+this.getCloseClip,l);return}t.addBehavior(new L("PlayAnimationOnProximity_"+this.gameObject.name,F.proximityToCameraTrigger(this.gameObject,this.distance),o));return}}}de([a(kt)],Tt.prototype,"target",2);de([a()],Tt.prototype,"getCloseClip",2);de([a()],Tt.prototype,"distance",2);var an=Object.defineProperty,ln=Object.getOwnPropertyDescriptor,Et=(r,t,i,s)=>{for(var e=s>1?void 0:s?ln(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&an(t,i,e),e};class at extends h{constructor(){super(...arguments),this.distance=.5,this.targetState=!0}createBehaviours(t,i,s){}async afterSerialize(t,i){}}Et([a(H)],at.prototype,"target",2);Et([a(URL)],at.prototype,"clip",2);Et([a()],at.prototype,"distance",2);Et([a()],at.prototype,"targetState",2);var hn=Object.defineProperty,cn=Object.getOwnPropertyDescriptor,K=(r,t,i,s)=>{for(var e=s>1?void 0:s?cn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&hn(t,i,e),e};class Mt{constructor(){this.contents=[],this.negativeContents=[],this.triggers=[]}}K([a(S)],Mt.prototype,"contents",2);K([a(S)],Mt.prototype,"negativeContents",2);K([a(S)],Mt.prototype,"triggers",2);class At extends h{constructor(){super(...arguments),this.elements=[],this.fadeDuration=.2,this.selectFirstOnStart=!0,this._allTargets=[],this._allTriggers=[]}get currentIndex(){return this._currentIndex}get defaultVariant(){const t=this.selectFirstOnStart?this.elements.at(0):void 0;return this._currentIndex!==void 0?this.elements.at(this._currentIndex):t}awake(){this.elements.forEach(t=>{t.contents=t.contents.filter(i=>i),t.triggers=t.triggers.filter(i=>i)}),this.elements.forEach(t=>{var i;return(i=t.contents)==null?void 0:i.forEach(s=>this._allTargets.push(s))}),this.elements.forEach(t=>{var i;return(i=t.triggers)==null?void 0:i.forEach(s=>this._allTriggers.push(s))}),this.setupForRuntime()}setupForRuntime(){this.elements.forEach((t,i)=>{var s;(s=t.triggers)==null||s.forEach(e=>{const n=Mi(e,xt);n.onClick??(n.onClick=new x),n.onClick.addEventListener(()=>{this._currentIndex=i,this._allTargets.forEach(o=>{o.visible=t.contents.includes(o)})})})}),this.selectDefault()}selectDefault(){var i;const t=((i=this.defaultVariant)==null?void 0:i.contents)??[];this._allTargets.forEach(s=>{s.visible=t.includes(s)})}createBehaviours(t,i,s){i.uuid===this.gameObject.uuid&&this.setupForUSDZ(t)}beforeCreateDocument(t,i){this._allTargets.forEach(s=>{s.visible=!0})}async afterSerialize(t,i){await Bt(3),this.selectDefault()}setupForUSDZ(t){var e;this.elements.forEach(n=>{var o;(o=n.triggers)==null||o.forEach(l=>{const p=n.contents,d=this._cloneArray(this._allTargets).filter(u=>!p.includes(u));p.length>=0&&t.addBehavior(new L(`EnableObject_${l.uuid}`,F.tapTrigger(l),_.fadeAction(p,this.fadeDuration,!0))),d.length>=0&&t.addBehavior(new L(`DisableObject_${l.uuid}`,F.tapTrigger(l),_.fadeAction(d,this.fadeDuration,!1)))})});const i=((e=this.defaultVariant)==null?void 0:e.contents)??[],s=this._cloneArray(this._allTargets).filter(n=>!i.includes(n));t.addBehavior(new L(`HideOnStart_${this.guid}`,F.sceneStartTrigger(),_.fadeAction(s,0,!1)))}_cloneArray(t){const i=new Array(t.length);return t.forEach((s,e)=>i[e]=s),i}}K([a(Mt)],At.prototype,"elements",2);K([a()],At.prototype,"fadeDuration",2);K([a()],At.prototype,"selectFirstOnStart",2);var pn=Object.defineProperty,dn=Object.getOwnPropertyDescriptor,A=(r,t,i,s)=>{for(var e=s>1?void 0:s?dn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&pn(t,i,e),e};class Q{constructor(){this.name="Name"}}A([a()],Q.prototype,"name",2);A([a(Ot)],Q.prototype,"icon",2);A([a(x)],Q.prototype,"click",2);class Y{constructor(){this.title="Title",this.items=[]}}A([a()],Y.prototype,"title",2);A([a(Ot)],Y.prototype,"icon",2);A([a(x)],Y.prototype,"select",2);A([a(x)],Y.prototype,"deselect",2);A([a(Q)],Y.prototype,"items",2);class lt extends h{constructor(){super(...arguments),this.categories=[]}awake(){document.body.insertAdjacentHTML("afterbegin",`<style>${bn}</style>`),document.body.insertAdjacentHTML("afterbegin",gn),this.mainmenu=document.querySelector(".mainmenu"),this.submenuRoot=document.querySelector(".submenu-wrapper"),this.submenu=document.querySelector(".submenu"),this.submenuTitle=document.querySelector(".submenu-title"),this.submenuContent=document.querySelector(".submenu-content"),this.categories.forEach(t=>this.addCategory(t)),this.hideSubmenu()}addNewCategory(t){this.categories.push(t),this.addCategory(t)}addCategory(t){if(!this.mainmenu)return;const i=un(t);this.mainmenu.appendChild(i),i.onclick=()=>{this.selectedCategory===t?this.hideSubmenu():this.showSubmenu(t)}}addItem(t){if(!this.submenuContent)return;const i=fn(t);this.submenuContent.appendChild(i),i.onclick=()=>{var s;(s=t.click)==null||s.invoke()}}showSubmenu(t){var i,s,e,n;for(this.selectedCategory=t,(s=(i=this.selectedCategory)==null?void 0:i.select)==null||s.invoke(),this.submenuTitle&&(this.submenuTitle.textContent=t.title);(e=this.submenuContent)!=null&&e.firstChild;)this.submenuContent.removeChild(this.submenuContent.firstChild);t.items.forEach(o=>this.addItem(o)),(n=this.submenuRoot)==null||n.classList.remove("close")}hideSubmenu(){var t,i,s,e,n;for((i=(t=this.selectedCategory)==null?void 0:t.deselect)==null||i.invoke(),this.selectedCategory=void 0;(s=this.submenuContent)!=null&&s.firstChild;)(e=this.submenuContent)==null||e.removeChild(this.submenuContent.firstChild);(n=this.submenuRoot)==null||n.classList.add("close")}}A([a(Y)],lt.prototype,"categories",2);const mn="https://upload.wikimedia.org/wikipedia/commons/2/21/City_locator_4.svg",un=r=>{var i;const t=document.createElement("button");return t.classList.add("room"),t.classList.add("open-submenu"),t.innerHTML=`
        <button class="open-submenu">
            <span class="icon">
                <img src=${((i=r.icon)==null?void 0:i.url)??mn} alt=${r.title??"?"}>
            </span>
        </button>
    `,t},fn=r=>{var e;const t=document.createElement("button");t.classList.add("submenu-button");const i=`
        <img src=${(e=r.icon)==null?void 0:e.url} alt=${r.name??"?"}>
    `,s=`
        <a>${r.name}</a>
    `;return r.icon&&(t.innerHTML+=i),t.innerHTML+=s,t},gn=`
  <div class="mainmenu">
    <!-- Content -->
  </div>

  <div class="submenu-wrapper">
    <h2 class="submenu-title"></h2>
    <div class="submenu">
        <div class="submenu-content">
            <!-- Content -->
        </div>
    </div>
  </div>
`,bn=`
.mainmenu {
    position: absolute;
    top: 16px;
    right: 16px;
    display: flex;
    flex-direction: column;
    align-items: center;
    width: 54px;
    height: auto;
    background: rgba(229, 230, 233, 0.8);
    border-radius: 27px;
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    box-shadow: 0 0 4px rgba(2, 2, 43, 0.2);
    z-index: 1;
    padding-top: 6px;

    /* default font settings */
    font-size: 1rem;
    font-family: 'Roboto Flex', sans-serif;
    /* font-optical-sizing: auto; */
    /* font-variation-settings: "width" 100; */
    color: rgb(40, 40, 40);
}

.mainmenu button {
    width: 42px;
    height: 42px;
    border: none;
    border-radius: 50%;
    margin-bottom: 4px;
    background: transparent;
    transition: background-color 0.5s;
    outline: rgba(0, 0, 0, 0) 1px solid;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
}

.mainmenu button.active,
.mainmenu button:hover {
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.mainmenu button.active img,
.mainmenu button:hover img
{
    /* filter: invert(100%) sepia(0%) saturate(7478%) hue-rotate(317deg) brightness(109%) contrast(99%); */
}

.mainmenu button img {
    width: 32px;
    height: 32px;
}

.mainmenu button .state-icon {
    position: absolute;
    top: 9px;
    left: 11px;
    width: 32px; 
    height: 32px; 
    background-size: cover;
    background-repeat: no-repeat;
    pointer-events: none; 
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.mainmenu button.active .state-icon,
.mainmenu button:hover .state-icon
{
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

/*Submenu*/
.submenu-wrapper {
    position: absolute;
    top: 16px;
    right: calc(70px + 10px);
    width: 333px;
    max-height: 60vh;
    padding: 22px;
    z-index: 1;

    background: #ffffff5c;
    border: 1px solid rgba(255, 255, 255, .1);
    border-radius: 1.1999rem;
    outline: rgb(0 0 0 / 5%) 1px solid;
    box-shadow: 0px 7px 0.5rem 0px rgb(0 0 0 / 6%), inset 0px 0px 1.3rem rgba(0, 0, 0, .05);
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);

    overflow: hidden;
}

.submenu {
    overflow-x: hidden;
    overflow-y: scroll;
    max-height: calc(60vh - 22px * 2);
    font-family: 'Roboto Flex', sans-serif;
}

/* width */
.submenu::-webkit-scrollbar {
    scrollbar-color: #ff0000;
    width: 5px;
}

/* Track */
.submenu::-webkit-scrollbar-track {
    background: #8880;
    margin-right: 20px;
}

/* Handle */
.submenu::-webkit-scrollbar-thumb {
    background: #8888;
    border-radius: 10px; /* Rounded corners */
    margin: 0 8px; /* Offset the track to move the thumb left */
}

/* Handle on hover */
.submenu::-webkit-scrollbar-thumb:hover {
    background: #555A;
}

.submenu-title {
    color: #282828;
    font-size: 22px;
    font-weight: 800;
    line-height: 32px;
    margin-bottom: 16px;
    margin-top: 0px;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
    border-bottom: 1px solid rgba(40, 40, 40, .4);
    font-family: 'Roboto Flex', sans-serif;
}

.submenu-button {
    height: 1.8rem;
    display: flex;
    align-items: center;
    margin-bottom: 8px;
    font-size: 1rem;
    line-height: 32px;
    border: none;
    cursor: pointer;
    font-family: 'Roboto Flex', sans-serif;
    font-weight: 200;
    width: 100%;
    
    background: transparent;
    outline: rgba(0, 0, 0, 0) 1px solid;
    border-radius: 0.8rem;
}

.submenu-button:hover { 
    background: rgba(245, 245, 245, .8);
    transition: all 0.1s linear .02s;
    outline: rgba(0, 0, 0, .05) 1px solid;
}

.submenu-button img {
    width: 32px;
    height: 32px;
    margin-right: 6px;
    margin-left: -6px;
}

.submenu-button a {
    color: #282828;
    text-overflow: ellipsis;
    white-space: nowrap;
    overflow: hidden;
}

.submenu-content img {
    max-width: 100%;
    height: auto;
    margin-right: 6px;
}

.special {
    display: flex;
    align-items: center;
    margin-top: 16px;
    font-size: 13px;
    line-height: 20px;
    color: #919191;
    border: none;
    background: none;
}

.special img {
    width: 16px;
    height: 16px;
    filter: invert(61%) sepia(85%) saturate(1169%) hue-rotate(92deg) brightness(92%) contrast(86%);
}

.submenu-wrapper.close {
    display: none;
}

@media screen and (max-width: 768px) {
    .mainmenu {
        width: 42px;
        height: auto;
        padding-bottom: 2px;
    }

    .mainmenu button {
        width: 32px;
        height: 32px;
    }

    .mainmenu button img {
        width: 24px;
        height: 24px;
    }

    .mainmenu button .state-icon {
        position: absolute;
        top: 9px;
        left: 9px;
        width: 24px; 
        height: 24px; 
    }

    .submenu-wrapper {
        right: calc(60px + 5px);
        width: 256px;
        border-radius: 21px;
        padding: 16px;
        max-height: 40vh;
    }

    .submenu {
        max-height: calc(40vh - 16px * 2);
    }

    .submenu-title {
        font-size: 18px;
        line-height: 28px;
        margin-bottom: 10px;
    }

    .submenu-button {
        margin-bottom: 6px;
        /* font-size: 1.3rem; */
        line-height: 24px;
    }

    .submenu-button img {
        width: 24px;
        height: 24px;
    }

    .special {
        margin-top: 10px;
        font-size: 11px;
    }

    .special img {
        width: 10px;
        height: 10px;
    }
}`;var xn=Object.defineProperty,vn=Object.getOwnPropertyDescriptor,Z=(r,t,i,s)=>{for(var e=s>1?void 0:s?vn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&xn(t,i,e),e};class me{}Z([a(xt)],me.prototype,"button",2);Z([a(U)],me.prototype,"label",2);class ht extends h{constructor(){super(...arguments),this.categoryName="",this.data=[]}awake(){var i;this.galleryUI??(this.galleryUI=Se(lt));const t=(i=this.galleryUI)==null?void 0:i.categories.find(s=>s.title===this.categoryName);t&&this.data.forEach(s=>{var n,o;const e=new Q;e.name=((n=s.label)==null?void 0:n.text)||"",e.icon=this.icon,e.click=new x,(o=e.click)==null||o.addEventListener(()=>{var l,p;(p=(l=s.button)==null?void 0:l.onClick)==null||p.invoke()}),t.items.push(e)})}}Z([a(lt)],ht.prototype,"galleryUI",2);Z([a()],ht.prototype,"categoryName",2);Z([a(Ot)],ht.prototype,"icon",2);Z([a(me)],ht.prototype,"data",2);var wn=Object.defineProperty,_n=Object.getOwnPropertyDescriptor,ni=(r,t,i,s)=>{for(var e=s>1?void 0:s?_n(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&wn(t,i,e),e};class $t extends h{constructor(){super(...arguments),this.title="",this.slug=""}initialize(t){this.galleryManager=t}start(){this.slug=On(this.title),j("poi")===this.slug&&this.focus()}focus(){var t,i;Zt("poi",this.slug),(t=this.galleryManager)==null||t.poiFocused(this),this.cameraView&&(this.previousOrbitControls??(this.previousOrbitControls=Se(Qt)),(i=this.previousOrbitControls)==null||i.setCameraAndLookTarget(this.cameraView))}focusNext(){var t;(t=this.galleryManager)==null||t.focusNext()}focusPrevious(){var t;(t=this.galleryManager)==null||t.focusPrevious()}}ni([a(S)],$t.prototype,"cameraView",2);ni([a()],$t.prototype,"title",2);function On(r){return r.trim().toLowerCase().replace(/ /g,"-")}var yn=Object.defineProperty,Pn=Object.getOwnPropertyDescriptor,ct=(r,t,i,s)=>{for(var e=s>1?void 0:s?Pn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&yn(t,i,e),e};class k extends h{constructor(){super(...arguments),this.pois=[],this.categoryName="",this.arrowKeysNavigation=!0,this.selectedPOIIndex=0}awake(){this.populateGalleryUI(this.pois),this.pois.forEach(t=>t.initialize(this))}populateGalleryUI(t){var s;if(!this.galleryUI)return;const i=(s=this.galleryUI)==null?void 0:s.categories.find(e=>e.title===this.categoryName);i&&t.forEach(e=>{const n=new Q;n.name=e.title,n.icon=this.icon,n.click=new x,n.click.addEventListener(()=>{e.focus()}),i.items.push(n)})}poiFocused(t){const i=this.pois.indexOf(t);i!=-1&&(this.selectedPOIIndex=i)}focusNext(){var t;this.selectedPOIIndex=(this.selectedPOIIndex+1)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}focusPrevious(){var t;this.selectedPOIIndex=(this.selectedPOIIndex-1+this.pois.length)%this.pois.length,(t=this.pois[this.selectedPOIIndex])==null||t.focus()}update(){if(this.arrowKeysNavigation){const t=this.context.input;t.isKeyDown("ArrowRight")?this.focusNext():t.isKeyDown("ArrowLeft")&&this.focusPrevious()}}}ct([a($t)],k.prototype,"pois",2);ct([a(lt)],k.prototype,"galleryUI",2);ct([a()],k.prototype,"categoryName",2);ct([a(Ot)],k.prototype,"icon",2);ct([a()],k.prototype,"arrowKeysNavigation",2);var Cn=Object.defineProperty,jn=Object.getOwnPropertyDescriptor,oi=(r,t,i,s)=>{for(var e=s>1?void 0:s?jn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Cn(t,i,e),e};const Vt=j("debugmaterialx");class ue extends h{constructor(){super(...arguments),this.images=[]}async awake(){this.materialXAsset&&this.loadMaterialX(this.materialXAsset)}async loadMaterialX(t){const i=m.getComponent(this.gameObject,C);if(!i)return;const s=new Yi;s.resolveURL=o=>{if(o.startsWith("assets/"))return o;const p=o.split("/").pop();return Vt&&console.log("resolveURL",o,p),"assets/"+p};const n=await new es(s).setPath("").loadAsync(t).then(({materials:o})=>(Vt&&console.log("Loaded .mtlx materials",o),Object.values(o)[0]));Vt&&console.log("Loaded .mtlx material",n,t),n&&(i.sharedMaterial=n)}}oi([a(URL)],ue.prototype,"materialXAsset",2);oi([a(Ai)],ue.prototype,"images",2);const Sn=j("debugmaterialx");class Dn extends h{start(){const t=m.getComponent(this.gameObject,C);t&&(this.material=new Zi({}),t.sharedMaterial=this.material,this.constructNodeGraph(this.material),this.material.needsUpdate=!0)}constructNodeGraph(t){const i=ki(1),s=Bi.mul(10).add(i),e=Xi(s);t.colorNode=e}update(){if(J()&&this.material&&this.constructNodeGraph!==this.methodCacheKey){Sn&&console.log("rebuilding node graph"),this.methodCacheKey=this.constructNodeGraph;try{this.constructNodeGraph(this.material),this.material.needsUpdate=!0}catch(t){throw console.error(t),f(t.message,Ce.Error),t}}}}var Tn=Object.defineProperty,En=Object.getOwnPropertyDescriptor,Mn=(r,t,i,s)=>{for(var e=s>1?void 0:s?En(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Tn(t,i,e),e};class Kt extends h{constructor(){super(...arguments),this.time=0,this._timeThreshold=.3}awake(){this._director=this.gameObject.getComponentInChildren($i)??void 0}onAfterRender(){if(!this._director)return;Math.abs(this._director.time-this.time)>this._timeThreshold&&(this.time=this._director.time)}onTimeChanged(){!this._director||Math.abs(this._director.time-this.time)<this._timeThreshold||(this._director.time=this.time,this._director.isPlaying||this._director.evaluate())}}Mn([G(Kt.prototype.onTimeChanged)],Kt.prototype,"time",2);var An=Object.defineProperty,$n=Object.getOwnPropertyDescriptor,B=(r,t,i,s)=>{for(var e=s>1?void 0:s?$n(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&An(t,i,e),e};class z extends h{constructor(){super(...arguments),this.consumeClick=!0,this.consumeDown=!0,this.consumeMove=!0,this.consumeUp=!0,this.consumeHover=!0,this.stopPropagation=!0}onPointerDown(t){this.consumeDown&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerMove(t){this.consumeMove&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerUp(t){this.consumeUp&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerClick(t){this.consumeClick&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerEnter(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}onPointerExit(t){this.consumeHover&&t.use(),this.stopPropagation&&t.stopPropagation()}}B([a()],z.prototype,"consumeClick",2);B([a()],z.prototype,"consumeDown",2);B([a()],z.prototype,"consumeMove",2);B([a()],z.prototype,"consumeUp",2);B([a()],z.prototype,"consumeHover",2);B([a()],z.prototype,"stopPropagation",2);var In=Object.defineProperty,Ln=Object.getOwnPropertyDescriptor,Fn=(r,t,i,s)=>{for(var e=s>1?void 0:s?Ln(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&In(t,i,e),e};class ai extends h{constructor(){super(...arguments),this.renderers=[]}select(t){this.renderers.forEach(i=>{i.probeAnchor=t})}}Fn([a(C)],ai.prototype,"renderers",2);var Vn=Object.defineProperty,Nn=Object.getOwnPropertyDescriptor,Un=(r,t,i,s)=>{for(var e=s>1?void 0:s?Nn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Vn(t,i,e),e};class fe extends h{constructor(){super(...arguments),this.displayName=""}}Un([a()],fe.prototype,"displayName",2);var zn=Object.defineProperty,Wn=Object.getOwnPropertyDescriptor,It=(r,t,i,s)=>{for(var e=s>1?void 0:s?Wn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&zn(t,i,e),e};class pt extends h{constructor(){super(...arguments),this.objects=[],this.hideContentOnStart=!0,this.index=-1}awake(){this.hideContentOnStart||(this.index=0);const t=j("variant");typeof t=="string"?this.index=parseInt(t):typeof t=="number"&&(this.index=t),this.apply()}next(){this.select(this.index+1)}previous(){this.select(this.index-1)}apply(){for(let t=0;t<this.objects.length;t++)this.objects[t].visible=t===this.index;if(this.lable){const t=this.objects[this.index];if(t){const i=m.getComponent(t,fe);this.lable.text=(i==null?void 0:i.displayName)??t.name}}}select(t){t<0&&(t=this.objects.length-1),this.index=t%this.objects.length,this.index=b.clamp(this.index,0,this.objects.length-1),Zt("variant",this.index.toString()),this.apply()}}It([a(S)],pt.prototype,"objects",2);It([a()],pt.prototype,"hideContentOnStart",2);It([a(U)],pt.prototype,"lable",2);It([G(function(){this.apply()})],pt.prototype,"index",2);c.add("AspectRatioFitterUI",Xt);c.add("CameraGoal",yt);c.add("CameraLayer",os);c.add("Cannon",tt);c.add("RandomColor",te);c.add("ChangeColorOnCollision",ps);c.add("IncreaseShaderSpeedOverTime",Ie);c.add("ClickButton",Le);c.add("ClickToReset",Fe);c.add("DepthOfFieldController",Ct);c.add("DisableEnvironmentLight",ys);c.add("EmitParticlesOnClick",Ve);c.add("EnforceParameters",Ne);c.add("HTMLButtonClick",ie);c.add("HTMLMenu",se);c.add("IFrameContent",et);c.add("ImageTrackingDownloadUI",Vs);c.add("LODGroupUI",re);c.add("Networking_ClickToChangeColor",Rt);c.add("Networking_StringArray",Ht);c.add("Networking_Object",Gt);c.add("PerformanceSettings",oe);c.add("Photographer",it);c.add("PhysicsCollision",st);c.add("PhysicsTrigger",rt);c.add("PlayAnimationOnCollision",He);c.add("PlayAnimationOnTrigger",Ge);c.add("PlayAudioOnCollision",qe);c.add("ResetAnimationsForXR",rr);c.add("ResponsiveContent",ae);c.add("LoadingSceneRoot",Qe);c.add("SceneLoadingEvents",he);c.add("SceneSwitcherControls",hr);c.add("SetBackfaceCulling",cr);c.add("ShowBalloonMessage",Ye);c.add("SimpleLeaderboard",qt);c.add("StartPosition",Ze);c.add("AutoReset",ke);c.add("SyncedRoomUI",Be);c.add("TimedSpawn",Xe);c.add("TopMenu",Je);c.add("VideoBackground",Er);c.add("ResetPositionOnInterval",nt);c.add("ToggleVisibility",$r);c.add("WireframeMaterial",ti);c.add("XRLifecycleEvents",ce);c.add("WebXRBodyTracking",Ur);c.add("Arrow",pe);c.add("ArrowShooting",D);c.add("BowArrowTarget",si);c.add("BowTargetSpawner",ri);c.add("CustomDepthSensing",Jr);c.add("DeviceDetection",tn);c.add("CustomUSDSettings",en);c.add("FadeOnProximity",q);c.add("PlayAnimationOnProximity",Tt);c.add("SoundOnProximity",at);c.add("EverywhereConfigurator",At);c.add("ButtonAndTextFiller",ht);c.add("GalleryManager",k);c.add("GalleryPOI",$t);c.add("GalleryUI",lt);c.add("MaterialXAsset",ue);c.add("ShadeWithMaterialX",Dn);c.add("SyncedPlayableDirector",Kt);c.add("ConsumeAllPointers",z);c.add("ReflectionsSwitcher",ai);c.add("VariantInfo",fe);c.add("VariantSwitcher",pt);var Rn=Object.defineProperty,Hn=Object.getOwnPropertyDescriptor,O=(r,t,i,s)=>{for(var e=s>1?void 0:s?Hn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Rn(t,i,e),e};class Lt extends h{constructor(){super(...arguments),this.titleText="Title",this.contentText="Content",this.viewAngle=40,this.instance=null}start(){var i;const t=new ye;t.parent=this.gameObject,this.instance=m.instantiate(N.Instance.hotspotTemplate.gameObject,t),this.instance?(this.instance.removeFromParent(),this.gameObject.add(this.instance),this.hotspot=(i=this.instance)==null?void 0:i.getComponent(T),this.hotspot&&(m.setActive(this.hotspot.gameObject,!0),this.hotspot.init(this),N.Instance.registerHotspot(this.hotspot))):console.error("No hotspot template assigned to HotspotManager!")}destroy(){this.instance&&(m.destroy(this.instance),this.instance=null,this.hotspot=null)}}O([a()],Lt.prototype,"titleText",2);O([a()],Lt.prototype,"contentText",2);O([a()],Lt.prototype,"viewAngle",2);class T extends h{constructor(){super(...arguments),this.selected=!1,this.contentFadeTimestamp=-999,this.isVisible=!1,this.hotspotFadeTimestamp=-999,this.button=null}init(t){var i,s;this.hotspot=t,this.label&&(this.label.text=t.titleText),this.content&&(this.content.text=t.contentText),this.button=this.gameObject.getComponentInChildren(xt),(s=(i=this.button)==null?void 0:i.onClick)==null||s.addEventListener(this.onButtonClicked.bind(this))}onButtonClicked(){this.selected=!this.selected,this.contentFadeTimestamp=this.context.time.time,this.selected&&N.Instance&&N.Instance.onSelect(this)}deselect(){this.selected&&(this.contentFadeTimestamp=this.context.time.time,this.selected=!1)}onBeforeRender(t){if(!this.hotspot||!this.gameObject.parent)return;const i=this.context.mainCamera;if(i==null)return;if(this.context.isInXR){const mt=X(i);if(this.gameObject.lookAt(mt),this.context.xrSession.interactionMode==="screen-space"){const pi=mt.sub(this.forward);this.gameObject.lookAt(pi)}}else{const mt=Ut(i);Nt(this.gameObject,mt)}const s=xe(this.gameObject.parent),e=xe(i),o=X(this.gameObject).clone().clone();i.worldToLocal(o);const l=-1*o.z*e.x,p=b.clamp(i.fov,0,70),u=.25*Math.tan(p*b.Deg2Rad/2)*l/s.x;this.gameObject.scale.set(u,u,u);const y=this.hotspot.gameObject.getWorldDirection(v()),$=this.hotspot.worldPosition,W=i.getWorldPosition(v()),ci=v(W).sub($).normalize(),dt=b.toDegrees(y.angleTo(ci))<this.hotspot.viewAngle;dt!=this.isVisible&&(this.hotspotFadeTimestamp=this.context.time.time,this.button&&(this.button.enabled=dt),!dt&&this.selected&&(this.selected=!1,this.contentFadeTimestamp=this.context.time.time)),this.isVisible=dt,this.applyFade()}applyFade(){const t=this.isVisible?1:0,i=b.clamp01((this.context.time.time-this.hotspotFadeTimestamp)/this.hotspotFadeDuration),s=b.lerp(1-t,t,i),e=this.selected?1:0,n=b.clamp01((this.context.time.time-this.contentFadeTimestamp)/this.contentFadeDuration),o=b.lerp(1-e,e,n);this.contentCanvasGroup&&(this.contentCanvasGroup.alpha=Math.min(s,o),this.contentCanvasGroup.interactable=this.selected),this.headerCanvasGroup&&(this.headerCanvasGroup.alpha=s,this.headerCanvasGroup.interactable=this.isVisible)}}O([a(U)],T.prototype,"label",2);O([a(U)],T.prototype,"content",2);O([a()],T.prototype,"contentFadeDuration",2);O([a()],T.prototype,"hotspotFadeDuration",2);O([a(Ii)],T.prototype,"canvas",2);O([a(De)],T.prototype,"contentCanvasGroup",2);O([a(De)],T.prototype,"headerCanvasGroup",2);const li=class extends h{constructor(){super(...arguments),this.forceSingleActive=!0,this.activeHotspots=[]}awake(){li.Instance=this,this.hotspotTemplate.gameObject.position.set(0,0,0),this.hotspotTemplate.gameObject.scale.set(1,1,1),this.hotspotTemplate.gameObject.quaternion.identity(),this.hotspotTemplate.gameObject.removeFromParent(),m.setActive(this.hotspotTemplate.gameObject,!1)}registerHotspot(r){this.activeHotspots.indexOf(r)===-1&&this.activeHotspots.push(r)}onSelect(r){if(this.forceSingleActive)for(const t of this.activeHotspots)t!==r&&t&&t.deselect()}};let N=li;O([a(T)],N.prototype,"hotspotTemplate",2);O([a()],N.prototype,"forceSingleActive",2);var Gn=Object.defineProperty,qn=Object.getOwnPropertyDescriptor,Kn=(r,t,i,s)=>{for(var e=s>1?void 0:s?qn(t,i):t,n=r.length-1,o;n>=0;n--)(o=r[n])&&(e=(s?o(t,i,e):o(e))||e);return s&&e&&Gn(t,i,e),e};class hi extends h{constructor(){super(...arguments),this.targets=[]}start(){console.log("start"),console.log(this)}onPointerEnter(t){console.log("On Pointer Enter"),this.targets.forEach(i=>{const s=i;s&&s.onPointerEnter&&s.onPointerEnter(t)})}onPointerExit(t){console.log("On Pointer Exit"),this.targets.forEach(i=>{const s=i;s&&s.onPointerExit&&s.onPointerExit(t)})}onPointerClick(t){console.log("On Pointer Click"),this.targets.forEach(i=>{const s=i;s&&s.onPointerClick&&s.onPointerClick(t)})}onPointerUp(t){console.log("On Pointer Up"),this.targets.forEach(i=>{const s=i;s&&s.onPointerUp&&s.onPointerUp(t)})}onPointerDown(t){console.log("On Pointer Down"),this.targets.forEach(i=>{const s=i;s&&s.onPointerDown&&s.onPointerDown(t)})}}Kn([a(m)],hi.prototype,"targets",2);c.add("Hotspot",Lt);c.add("HotspotBehaviour",T);c.add("HotspotManager",N);c.add("UIEventRealy",hi);class Qn extends h{async start(){const t=m.findObjectOfType(wt),[i,s]=await Promise.all([R.isARSupported(),R.isVRSupported()]),n=document.createElement("a").relList.supports("ar")&&t,o=Li.getOrCreate(),l=o.createARButton(),p=o.createVRButton();l.remove(),p.remove();const d=document.querySelector(".ar-button");i?d.addEventListener("click",()=>{l.click()}):n&&d.addEventListener("click",()=>{t.exportAndOpen()});const u=document.querySelector(".vr-button");s&&u.addEventListener("click",()=>{p.click()}),i||n?d.classList.add("supported"):d.classList.add("not-supported"),s?u.classList.add("supported"):u.classList.add("not-supported")}}c.add("CustomXRButtons",Qn);
